{% extends "layout.html" %}

{% block title %}تذاكر الطيران{% endblock %}

{% block styles %}
<style>
    .form-section {
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        border-radius: 0.5rem;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        background-color: #fff;
        transition: all 0.3s ease;
    }
    
    .form-section:hover {
        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
        transform: translateY(-2px);
    }
    
    .section-title {
        border-bottom: 2px solid #17a2b8;
        padding-bottom: 0.5rem;
        margin-bottom: 1.5rem;
        color: #495057;
    }
    
    .form-control {
        border-radius: 0.5rem;
    }
    
    .form-control:focus {
        border-color: #80bdff;
        box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
    }
    
    .flight-type-option {
        padding: 15px;
        border-radius: 0.5rem;
        border: 1px solid #dee2e6;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .flight-type-option:hover {
        border-color: #17a2b8;
        background-color: #f8f9fa;
    }
    
    .selected-flight-type {
        background-color: #17a2b8;
        color: white;
        border-radius: 0.5rem;
        cursor: pointer;
    }
    
    .passenger-card {
        background-color: #f8f9fa;
        border-radius: 0.5rem;
        padding: 1rem;
        margin-bottom: 1rem;
        border: 1px dashed #adb5bd;
    }
    
    .return-flight-section {
        background-color: #f8f9fa;
        border-right: 3px solid #17a2b8;
        padding-right: 1rem;
    }
    
    .step-navigation {
        display: flex;
        justify-content: space-between;
        margin-top: 2rem;
    }
    
    .flight-progress {
        height: 0.5rem;
        margin-bottom: 2rem;
        border-radius: 0.25rem;
    }
    
    .step-indicator {
        width: 24%;
        text-align: center;
        position: relative;
        margin-bottom: 1rem;
    }
    
    .step-indicator::before {
        content: '';
        height: 30px;
        width: 30px;
        line-height: 30px;
        border: 1px solid #ddd;
        display: block;
        margin: 0 auto 10px auto;
        border-radius: 50%;
        background-color: white;
    }
    
    .step-indicator.active::before {
        background-color: #17a2b8;
        border-color: #17a2b8;
        color: white;
    }
    
    .step-text {
        font-size: 0.8rem;
        color: #6c757d;
    }
    
    .steps-container {
        display: flex;
        justify-content: space-between;
    }
    
    .custom-file-label::after {
        content: "استعراض";
    }
    
    .airline-logo {
        max-height: 30px;
        margin-left: 0.5rem;
    }
    
    .flight-card {
        border-radius: 0.5rem;
        transition: all 0.3s ease;
    }
    
    .flight-card:hover {
        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
    }
    
    .flight-details {
        display: flex;
        align-items: center;
        justify-content: space-between;
    }
    
    .flight-time {
        font-size: 1.2rem;
        font-weight: bold;
    }
    
    .flight-path {
        border-top: 2px dashed #dee2e6;
        position: relative;
        margin: 0 1rem;
        flex-grow: 1;
        text-align: center;
    }
    
    .flight-path i {
        position: absolute;
        top: -10px;
        left: 50%;
        transform: translateX(-50%);
        background-color: white;
        padding: 0 0.5rem;
    }
    
    .flight-duration {
        font-size: 0.9rem;
        color: #6c757d;
    }
    
    .flight-price {
        font-size: 1.2rem;
        font-weight: bold;
        color: #17a2b8;
    }
    
    /* تحسينات التجاوب مع الشاشات المختلفة */
    @media (max-width: 768px) {
        .flight-details {
            flex-direction: column;
            align-items: center;
        }
        
        .flight-path {
            width: 100%;
            margin: 15px 0;
            border-top: none;
            border-right: 2px dashed #dee2e6;
            height: 70px;
        }
        
        .flight-path i {
            top: 50%;
            left: -10px;
            transform: translateY(-50%);
        }
        
        .flight-airline, .flight-price {
            width: 100%;
            text-align: center;
            margin-bottom: 10px;
        }
        
        .step-indicator {
            width: 100%;
            margin-bottom: 10px;
        }
        
        .steps-container {
            flex-direction: column;
        }
        
        .step-navigation {
            flex-direction: column;
        }
        
        .step-navigation button {
            margin-bottom: 10px;
            width: 100%;
        }
        
        .flight-type-option {
            margin-bottom: 15px;
        }
        
        /* تحسين الأزرار في الجداول للشاشات الصغيرة */
        .datatable .btn {
            padding: 0.2rem 0.4rem;
            margin: 0.1rem;
        }
        
        /* زيادة حجم الأيقونات للمس بسهولة على الأجهزة اللوحية والجوال */
        .btn i, .fas, .fa {
            font-size: 1.1rem;
        }
    }
    
    /* تحسينات عامة للأزرار والأيقونات */
    .btn {
        margin: 0.25rem;
        border-radius: 0.5rem;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
    }
    
    .btn i, .btn .fas, .btn .fa {
        margin-left: 0.5rem;
    }
    
    .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
    }
    
    .btn-sm {
        height: 32px;
        width: 32px;
        padding: 0;
        display: inline-flex;
        align-items: center;
        justify-content: center;
    }
    
    .btn-sm i {
        margin: 0;
    }
    
    .input-group-text {
        border-radius: 0.5rem 0 0 0.5rem;
    }
    
    /* تحسينات حقول الإدخال */
    .form-control {
        height: calc(2.25rem + 4px);
    }
    
    select.form-control {
        height: calc(2.25rem + 4px);
    }
    
    .input-group-text .fa,
    .input-group-text .fas {
        width: 1rem;
        text-align: center;
    }
    
    .form-section {
        overflow: hidden;
    }
</style>
{% endblock %}

{% block content %}
<!-- Content Header (Page header) -->
<div class="content-header">
    <div class="container-fluid">
        <div class="row mb-2">
            <div class="col-sm-6">
                <h1 class="m-0">تذاكر الطيران</h1>
            </div><!-- /.col -->
            <div class="col-sm-6">
                <ol class="breadcrumb float-sm-left">
                    <li class="breadcrumb-item"><a href="{{ url_for('index') }}">الرئيسية</a></li>
                    <li class="breadcrumb-item active">تذاكر الطيران</li>
                </ol>
            </div><!-- /.col -->
        </div><!-- /.row -->
    </div><!-- /.container-fluid -->
</div>
<!-- /.content-header -->

<!-- Main content -->
<section class="content">
    <div class="container-fluid">
        <!-- إحصائيات -->
        <div class="row">
            <div class="col-lg-3 col-6">
                <div class="small-box bg-info">
                    <div class="inner">
                        <h3>150</h3>
                        <p>إجمالي التذاكر</p>
                    </div>
                    <div class="icon">
                        <i class="fas fa-ticket-alt"></i>
                    </div>
                    <a href="#" class="small-box-footer">المزيد <i class="fas fa-arrow-circle-left"></i></a>
                </div>
            </div>
            
            <div class="col-lg-3 col-6">
                <div class="small-box bg-success">
                    <div class="inner">
                        <h3>85</h3>
                        <p>تذاكر مؤكدة</p>
                    </div>
                    <div class="icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <a href="#" class="small-box-footer">المزيد <i class="fas fa-arrow-circle-left"></i></a>
                </div>
            </div>
            
            <div class="col-lg-3 col-6">
                <div class="small-box bg-warning">
                    <div class="inner">
                        <h3>30</h3>
                        <p>تذاكر قيد الإجراء</p>
                    </div>
                    <div class="icon">
                        <i class="fas fa-clock"></i>
                    </div>
                    <a href="#" class="small-box-footer">المزيد <i class="fas fa-arrow-circle-left"></i></a>
                </div>
            </div>
            
            <div class="col-lg-3 col-6">
                <div class="small-box bg-danger">
                    <div class="inner">
                        <h3>15</h3>
                        <p>تذاكر ملغاة</p>
                    </div>
                    <div class="icon">
                        <i class="fas fa-ban"></i>
                    </div>
                    <a href="#" class="small-box-footer">المزيد <i class="fas fa-arrow-circle-left"></i></a>
                </div>
            </div>
        </div>
        
        <!-- التقارير والرسوم البيانية -->
        <div class="row">
            <!-- الرسم البياني للحجوزات -->
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-chart-line ml-2"></i>إحصائيات الحجوزات الشهرية
                        </h3>
                        <div class="card-tools">
                            <button type="button" class="btn btn-tool" data-card-widget="collapse">
                                <i class="fas fa-minus"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="chart">
                            <canvas id="airlineBookingsChart" style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- توزيع شركات الطيران -->
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-chart-pie ml-2"></i>توزيع شركات الطيران
                        </h3>
                        <div class="card-tools">
                            <button type="button" class="btn btn-tool" data-card-widget="collapse">
                                <i class="fas fa-minus"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="chart">
                            <canvas id="airlineDistributionChart" style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- نظرة عامة -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-plane ml-2"></i>حجوزات تذاكر الطيران
                        </h3>
                        <div class="card-tools">
                            <button type="button" class="btn btn-info" data-toggle="modal" data-target="#modal-add-airline-ticket">
                                <i class="fas fa-plus"></i> حجز تذكرة جديدة
                            </button>
                        </div>
                    </div>
                    <!-- /.card-header -->
                    <div class="card-body table-responsive p-0">
                        <table class="table table-hover text-nowrap datatable">
                            <thead>
                                <tr>
                                    <th>رقم الحجز</th>
                                    <th>اسم العميل</th>
                                    <th>مسار الرحلة</th>
                                    <th>تاريخ السفر</th>
                                    <th>شركة الطيران</th>
                                    <th>عدد المسافرين</th>
                                    <th>إجمالي السعر</th>
                                    <th>حالة الحجز</th>
                                    <th>الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>AT-2023001</td>
                                    <td>محمد أحمد</td>
                                    <td>الرياض - دبي</td>
                                    <td>2023-06-15</td>
                                    <td>الخطوط السعودية</td>
                                    <td>2</td>
                                    <td>2500 ريال</td>
                                    <td><span class="badge badge-success">مؤكد</span></td>
                                    <td>
                                        <button class="btn btn-info btn-action" title="عرض التفاصيل">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="btn btn-primary btn-action" title="تعديل الحجز">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-danger btn-action" title="حذف الحجز">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>AT-2023002</td>
                                    <td>أحمد محمود</td>
                                    <td>جدة - القاهرة (ذهاب وعودة)</td>
                                    <td>2023-06-20</td>
                                    <td>مصر للطيران</td>
                                    <td>1</td>
                                    <td>3200 ريال</td>
                                    <td><span class="badge badge-warning">قيد التأكيد</span></td>
                                    <td>
                                        <button class="btn btn-info btn-action" title="عرض التفاصيل">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="btn btn-primary btn-action" title="تعديل الحجز">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-danger btn-action" title="حذف الحجز">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <!-- /.card-body -->
                </div>
                <!-- /.card -->
            </div>
        </div>
        <!-- /.row -->
    </div>
    <!-- /.container-fluid -->
</section>
<!-- /.content -->

<!-- Modal حجز تذكرة طيران جديدة -->
<div class="modal fade" id="modal-add-airline-ticket">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-info">
                <h4 class="modal-title">حجز تذكرة طيران جديدة</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="airline-ticket-form">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle"></i> املأ جميع البيانات المطلوبة لإتمام حجز تذكرة الطيران.
                            </div>
                        </div>
                    </div>
                    
                    <!-- بيانات الرحلة والمسار -->
                    <div class="card card-outline card-primary mb-3">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-plane-departure ml-2"></i> بيانات الرحلة والمسار
                            </h3>
                        </div>
                        <div class="card-body">
                            
                            <div class="row mb-4">
                                <div class="col-md-4">
                                    <div class="flight-type-option selected-flight-type" data-flight-type="oneway">
                                        <i class="fas fa-plane fa-2x mb-3"></i>
                                        <h5>ذهاب فقط</h5>
                                        <p class="text-muted">رحلة باتجاه واحد</p>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="flight-type-option" data-flight-type="roundtrip">
                                        <i class="fas fa-exchange-alt fa-2x mb-3"></i>
                                        <h5>ذهاب وعودة</h5>
                                        <p class="text-muted">رحلة ذهاب وعودة</p>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="flight-type-option" data-flight-type="multicity">
                                        <i class="fas fa-route fa-2x mb-3"></i>
                                        <h5>وجهات متعددة</h5>
                                        <p class="text-muted">رحلة بعدة وجهات</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label for="customer_name">اسم العميل <span class="text-danger">*</span></label>
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text"><i class="fas fa-user"></i></span>
                                            </div>
                                            <input type="text" class="form-control" id="customer_name" placeholder="أدخل اسم العميل" required>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label for="phone">رقم الجوال <span class="text-danger">*</span></label>
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text"><i class="fas fa-phone"></i></span>
                                            </div>
                                            <input type="text" class="form-control" id="phone" placeholder="أدخل رقم الجوال" required>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="departure_city">مدينة المغادرة <span class="text-danger">*</span></label>
                                        <select class="form-control" id="departure_city" required>
                                            <option value="">اختر مدينة المغادرة</option>
                                            <option value="riyadh">الرياض</option>
                                            <option value="jeddah">جدة</option>
                                            <option value="dammam">الدمام</option>
                                            <option value="madinah">المدينة المنورة</option>
                                            <option value="cairo">القاهرة</option>
                                            <option value="dubai">دبي</option>
                                            <option value="abu-dhabi">أبو ظبي</option>
                                            <option value="doha">الدوحة</option>
                                            <option value="kuwait">الكويت</option>
                                            <option value="istanbul">اسطنبول</option>
                                            <option value="london">لندن</option>
                                            <option value="other">أخرى</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="arrival_city">مدينة الوصول <span class="text-danger">*</span></label>
                                        <select class="form-control" id="arrival_city" required>
                                            <option value="">اختر مدينة الوصول</option>
                                            <option value="riyadh">الرياض</option>
                                            <option value="jeddah">جدة</option>
                                            <option value="dammam">الدمام</option>
                                            <option value="madinah">المدينة المنورة</option>
                                            <option value="cairo">القاهرة</option>
                                            <option value="dubai">دبي</option>
                                            <option value="abu-dhabi">أبو ظبي</option>
                                            <option value="doha">الدوحة</option>
                                            <option value="kuwait">الكويت</option>
                                            <option value="istanbul">اسطنبول</option>
                                            <option value="london">لندن</option>
                                            <option value="other">أخرى</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="departure_date">تاريخ المغادرة <span class="text-danger">*</span></label>
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text"><i class="fas fa-calendar"></i></span>
                                            </div>
                                            <input type="date" class="form-control" id="departure_date" required>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6 return-date-field" style="display: none;">
                                    <div class="form-group">
                                        <label for="return_date">تاريخ العودة <span class="text-danger">*</span></label>
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text"><i class="fas fa-calendar-return"></i></span>
                                            </div>
                                            <input type="date" class="form-control" id="return_date">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="adults">عدد البالغين <span class="text-danger">*</span></label>
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text"><i class="fas fa-user"></i></span>
                                            </div>
                                            <input type="number" class="form-control" id="adults" value="1" min="1" required>
                                        </div>
                                        <small class="form-text text-muted">أكبر من 12 سنة</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="children">عدد الأطفال</label>
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text"><i class="fas fa-child"></i></span>
                                            </div>
                                            <input type="number" class="form-control" id="children" value="0" min="0">
                                        </div>
                                        <small class="form-text text-muted">من 2 إلى 12 سنة</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="infants">عدد الرضع</label>
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text"><i class="fas fa-baby"></i></span>
                                            </div>
                                            <input type="number" class="form-control" id="infants" value="0" min="0">
                                        </div>
                                        <small class="form-text text-muted">أقل من 2 سنة</small>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="travel_class">درجة السفر <span class="text-danger">*</span></label>
                                        <select class="form-control" id="travel_class" required>
                                            <option value="economy">الدرجة السياحية</option>
                                            <option value="business">درجة رجال الأعمال</option>
                                            <option value="first">الدرجة الأولى</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="airline">شركة الطيران المفضلة</label>
                                        <select class="form-control" id="airline">
                                            <option value="">أي شركة طيران</option>
                                            <option value="saudi">الخطوط السعودية</option>
                                            <option value="emirates">طيران الإمارات</option>
                                            <option value="etihad">الاتحاد للطيران</option>
                                            <option value="qatar">الخطوط القطرية</option>
                                            <option value="egyptair">مصر للطيران</option>
                                            <option value="turkish">الخطوط التركية</option>
                                            <option value="other">أخرى</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="step-navigation">
                            <div class="row">
                                <div class="col-md-6 col-sm-12 mb-2">
                                    <button type="button" class="btn btn-default btn-block" data-dismiss="modal"><i class="fas fa-times ml-2"></i>إلغاء</button>
                                </div>
                                <div class="col-md-6 col-sm-12">
                                    <button type="button" class="btn btn-info btn-block next-step" data-next="section-passenger-details">التالي <i class="fas fa-arrow-left"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- القسم 2: بيانات المسافرين -->
                    <div class="section" id="section-passenger-details" style="display: none;">
                        <div class="form-section">
                            <h4 class="section-title">
                                <i class="fas fa-users ml-2"></i>بيانات المسافرين
                            </h4>
                            
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle ml-2"></i>
                                يرجى إدخال بيانات المسافرين كما هي مدونة في جوازات السفر أو الهويات.
                            </div>
                            
                            <div id="passengers-container">
                                <!-- سيتم إضافة بطاقات المسافرين هنا بواسطة JavaScript -->
                            </div>
                        </div>
                        
                        <div class="step-navigation">
                            <div class="row">
                                <div class="col-md-6 col-sm-12 mb-2">
                                    <button type="button" class="btn btn-default btn-block prev-step" data-prev="section-flight-type"><i class="fas fa-arrow-right"></i> السابق</button>
                                </div>
                                <div class="col-md-6 col-sm-12">
                                    <button type="button" class="btn btn-info btn-block next-step" data-next="section-flight-details">التالي <i class="fas fa-arrow-left"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- القسم 3: تفاصيل الرحلات -->
                    <div class="section" id="section-flight-details" style="display: none;">
                        <div class="form-section">
                            <h4 class="section-title">
                                <i class="fas fa-info-circle ml-2"></i>تفاصيل الرحلات المتاحة
                            </h4>
                            
                            <div class="outbound-flights">
                                <h5 class="mb-3"><i class="fas fa-plane-departure ml-2"></i>رحلات الذهاب</h5>
                                
                                <!-- مثال على كارت رحلة -->
                                <div class="card mb-3 flight-card">
                                    <div class="card-body">
                                        <div class="form-check mb-3">
                                            <input class="form-check-input" type="radio" name="outbound_flight" id="outbound_flight_1" value="flight1" checked>
                                            <label class="form-check-label w-100" for="outbound_flight_1">
                                                <div class="flight-details">
                                                    <div class="flight-airline d-flex align-items-center">
                                                        <img src="https://upload.wikimedia.org/wikipedia/commons/d/d3/Saudia_Logo.svg" alt="Saudia" class="airline-logo">
                                                        <div>
                                                            <div>الخطوط السعودية</div>
                                                            <small class="text-muted">SV 1234</small>
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="text-center">
                                                        <div class="flight-time">08:30</div>
                                                        <small class="text-muted">الرياض (RUH)</small>
                                                    </div>
                                                    
                                                    <div class="flight-path">
                                                        <i class="fas fa-plane"></i>
                                                        <div class="flight-duration">2 ساعة 15 دقيقة</div>
                                                    </div>
                                                    
                                                    <div class="text-center">
                                                        <div class="flight-time">10:45</div>
                                                        <small class="text-muted">دبي (DXB)</small>
                                                    </div>
                                                    
                                                    <div class="flight-price">
                                                        1200 ر.س
                                                    </div>
                                                </div>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="card mb-3 flight-card">
                                    <div class="card-body">
                                        <div class="form-check mb-3">
                                            <input class="form-check-input" type="radio" name="outbound_flight" id="outbound_flight_2" value="flight2">
                                            <label class="form-check-label w-100" for="outbound_flight_2">
                                                <div class="flight-details">
                                                    <div class="flight-airline d-flex align-items-center">
                                                        <img src="https://upload.wikimedia.org/wikipedia/commons/d/d0/Emirates_logo.svg" alt="Emirates" class="airline-logo">
                                                        <div>
                                                            <div>طيران الإمارات</div>
                                                            <small class="text-muted">EK 5678</small>
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="text-center">
                                                        <div class="flight-time">12:15</div>
                                                        <small class="text-muted">الرياض (RUH)</small>
                                                    </div>
                                                    
                                                    <div class="flight-path">
                                                        <i class="fas fa-plane"></i>
                                                        <div class="flight-duration">1 ساعة 55 دقيقة</div>
                                                    </div>
                                                    
                                                    <div class="text-center">
                                                        <div class="flight-time">14:10</div>
                                                        <small class="text-muted">دبي (DXB)</small>
                                                    </div>
                                                    
                                                    <div class="flight-price">
                                                        1350 ر.س
                                                    </div>
                                                </div>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="return-flights" style="display: none;">
                                <h5 class="mb-3 mt-4"><i class="fas fa-plane-arrival ml-2"></i>رحلات العودة</h5>
                                
                                <!-- مثال على كارت رحلة عودة -->
                                <div class="card mb-3 flight-card">
                                    <div class="card-body">
                                        <div class="form-check mb-3">
                                            <input class="form-check-input" type="radio" name="return_flight" id="return_flight_1" value="return_flight1" checked>
                                            <label class="form-check-label w-100" for="return_flight_1">
                                                <div class="flight-details">
                                                    <div class="flight-airline d-flex align-items-center">
                                                        <img src="https://upload.wikimedia.org/wikipedia/commons/d/d3/Saudia_Logo.svg" alt="Saudia" class="airline-logo">
                                                        <div>
                                                            <div>الخطوط السعودية</div>
                                                            <small class="text-muted">SV 1235</small>
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="text-center">
                                                        <div class="flight-time">16:30</div>
                                                        <small class="text-muted">دبي (DXB)</small>
                                                    </div>
                                                    
                                                    <div class="flight-path">
                                                        <i class="fas fa-plane"></i>
                                                        <div class="flight-duration">2 ساعة 20 دقيقة</div>
                                                    </div>
                                                    
                                                    <div class="text-center">
                                                        <div class="flight-time">18:50</div>
                                                        <small class="text-muted">الرياض (RUH)</small>
                                                    </div>
                                                    
                                                    <div class="flight-price">
                                                        1250 ر.س
                                                    </div>
                                                </div>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="step-navigation">
                            <div class="row">
                                <div class="col-md-6 col-sm-12 mb-2">
                                    <button type="button" class="btn btn-default btn-block prev-step" data-prev="section-passenger-details"><i class="fas fa-arrow-right"></i> السابق</button>
                                </div>
                                <div class="col-md-6 col-sm-12">
                                    <button type="button" class="btn btn-info btn-block next-step" data-next="section-payment">التالي <i class="fas fa-arrow-left"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- القسم 4: الدفع والتأكيد -->
                    <div class="section" id="section-payment" style="display: none;">
                        <div class="form-section">
                            <h4 class="section-title">
                                <i class="fas fa-money-bill-wave ml-2"></i>الدفع والتأكيد
                            </h4>
                            
                            <div class="row">
                                <div class="col-lg-7">
                                    <div class="card mb-4">
                                        <div class="card-header">
                                            <h5 class="mb-0">ملخص الحجز</h5>
                                        </div>
                                        <div class="card-body">
                                            <div class="booking-summary">
                                                <div class="d-flex justify-content-between border-bottom pb-2 mb-2">
                                                    <div>المسار</div>
                                                    <div>الرياض - دبي</div>
                                                </div>
                                                <div class="d-flex justify-content-between border-bottom pb-2 mb-2">
                                                    <div>نوع الرحلة</div>
                                                    <div>ذهاب فقط</div>
                                                </div>
                                                <div class="d-flex justify-content-between border-bottom pb-2 mb-2">
                                                    <div>تاريخ المغادرة</div>
                                                    <div>15 يونيو 2023</div>
                                                </div>
                                                <div class="d-flex justify-content-between border-bottom pb-2 mb-2">
                                                    <div>عدد المسافرين</div>
                                                    <div>1 بالغ</div>
                                                </div>
                                                <div class="d-flex justify-content-between border-bottom pb-2 mb-2">
                                                    <div>شركة الطيران</div>
                                                    <div>الخطوط السعودية</div>
                                                </div>
                                                <div class="d-flex justify-content-between border-bottom pb-2 mb-2">
                                                    <div>سعر التذكرة (للبالغين)</div>
                                                    <div>1200 ر.س × 1</div>
                                                </div>
                                                <div class="d-flex justify-content-between border-bottom pb-2 mb-2">
                                                    <div>رسوم الخدمة</div>
                                                    <div>50 ر.س</div>
                                                </div>
                                                <div class="d-flex justify-content-between font-weight-bold">
                                                    <div>الإجمالي</div>
                                                    <div class="text-info">1250 ر.س</div>
                                                </div>
                                                <div class="text-center mt-3">
                                                    <small class="amount-in-words">ألف ومئتان وخمسون ريالاً سعودياً</small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-lg-5">
                                    <div class="card mb-4">
                                        <div class="card-header">
                                            <h5 class="mb-0">معلومات الدفع</h5>
                                        </div>
                                        <div class="card-body">
                                            <div class="form-group">
                                                <label for="payment_method">طريقة الدفع <span class="text-danger">*</span></label>
                                                <select class="form-control" id="payment_method" required>
                                                    <option value="">اختر طريقة الدفع</option>
                                                    <option value="cash">نقدًا</option>
                                                    <option value="bank-transfer">تحويل بنكي</option>
                                                    <option value="credit-card">بطاقة ائتمان</option>
                                                    <option value="customer-account">حساب العميل</option>
                                                </select>
                                            </div>
                                            
                                            <div class="payment-details-cash" style="display: none;">
                                                <div class="form-group">
                                                    <label for="cashbox">الصندوق <span class="text-danger">*</span></label>
                                                    <select class="form-control" id="cashbox">
                                                        <option value="">اختر الصندوق</option>
                                                        <option value="main-cashbox">الصندوق الرئيسي</option>
                                                        <option value="branch-cashbox">صندوق الفرع</option>
                                                    </select>
                                                </div>
                                            </div>
                                            
                                            <div class="payment-details-bank" style="display: none;">
                                                <div class="form-group">
                                                    <label for="bank_account">الحساب البنكي <span class="text-danger">*</span></label>
                                                    <select class="form-control" id="bank_account">
                                                        <option value="">اختر الحساب البنكي</option>
                                                        <option value="alrajhi">بنك الراجحي</option>
                                                        <option value="riyadh">بنك الرياض</option>
                                                        <option value="ahli">البنك الأهلي</option>
                                                    </select>
                                                </div>
                                            </div>
                                            
                                            <div class="payment-details-credit" style="display: none;">
                                                <div class="form-group">
                                                    <label for="customer_account">حساب العميل <span class="text-danger">*</span></label>
                                                    <select class="form-control" id="customer_account">
                                                        <option value="">اختر حساب العميل</option>
                                                        <option value="account1">حساب محمد أحمد</option>
                                                        <option value="account2">حساب خالد محمد</option>
                                                        <option value="account3">حساب أحمد علي</option>
                                                    </select>
                                                </div>
                                            </div>
                                            
                                            <div class="form-group">
                                                <label for="down_payment">الدفعة المقدمة</label>
                                                <div class="input-group">
                                                    <input type="number" min="0" step="0.01" class="form-control amount-field" id="down_payment" placeholder="أدخل مبلغ الدفعة المقدمة">
                                                    <div class="input-group-append">
                                                        <span class="input-group-text">ر.س</span>
                                                    </div>
                                                </div>
                                                <small class="amount-in-words" id="down_payment_words"></small>
                                            </div>
                                            
                                            <div class="form-group">
                                                <label for="remaining_amount">المبلغ المتبقي</label>
                                                <div class="input-group">
                                                    <input type="number" min="0" step="0.01" class="form-control" id="remaining_amount" value="1250" readonly>
                                                    <div class="input-group-append">
                                                        <span class="input-group-text">ر.س</span>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div class="form-group">
                                                <label for="payment_notes">ملاحظات الدفع</label>
                                                <textarea class="form-control" id="payment_notes" rows="2" placeholder="أدخل أية ملاحظات متعلقة بالدفع"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="step-navigation">
                            <div class="row">
                                <div class="col-md-6 col-sm-12 mb-2">
                                    <button type="button" class="btn btn-default btn-block prev-step" data-prev="section-flight-details"><i class="fas fa-arrow-right"></i> السابق</button>
                                </div>
                                <div class="col-md-6 col-sm-12">
                                    <button type="submit" class="btn btn-success btn-block"><i class="fas fa-check ml-2"></i>تأكيد الحجز</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
<!-- /.modal -->
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // تهيئة النموذج متعدد الخطوات
        initializeAirlineForm();
        
        // تهيئة الرسم البياني للحجوزات الشهرية
        var bookingsChartCanvas = document.getElementById('airlineBookingsChart').getContext('2d');
        var bookingsChartData = {
            labels: ['يناير', 'فبراير', 'مارس', 'أبريل', 'مايو', 'يونيو', 'يوليو', 'أغسطس', 'سبتمبر', 'أكتوبر', 'نوفمبر', 'ديسمبر'],
            datasets: [
                {
                    label: 'دولية',
                    backgroundColor: 'rgba(60,141,188,0.4)',
                    borderColor: 'rgba(60,141,188,1)',
                    pointRadius: 3,
                    pointBackgroundColor: 'rgba(60,141,188,1)',
                    pointBorderColor: '#fff',
                    pointHoverRadius: 5,
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: 'rgba(60,141,188,1)',
                    data: [28, 32, 40, 45, 50, 65, 70, 85, 60, 55, 48, 42]
                },
                {
                    label: 'داخلية',
                    backgroundColor: 'rgba(210, 214, 222, 0.4)',
                    borderColor: 'rgba(210, 214, 222, 1)',
                    pointRadius: 3,
                    pointBackgroundColor: 'rgba(210, 214, 222, 1)',
                    pointBorderColor: '#fff',
                    pointHoverRadius: 5,
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: 'rgba(210, 214, 222, 1)',
                    data: [15, 18, 20, 25, 30, 35, 40, 45, 30, 25, 22, 20]
                }
            ]
        };
        
        var bookingsChartOptions = {
            maintainAspectRatio: false,
            responsive: true,
            legend: {
                display: true,
                position: 'top',
                rtl: true,
                labels: {
                    fontFamily: 'Tajawal, sans-serif'
                }
            },
            scales: {
                xAxes: [{
                    gridLines: {
                        display: false
                    },
                    ticks: {
                        fontFamily: 'Tajawal, sans-serif'
                    }
                }],
                yAxes: [{
                    gridLines: {
                        display: true
                    },
                    ticks: {
                        beginAtZero: true,
                        stepSize: 20,
                        fontFamily: 'Tajawal, sans-serif'
                    }
                }]
            }
        };
        
        new Chart(bookingsChartCanvas, {
            type: 'line',
            data: bookingsChartData,
            options: bookingsChartOptions
        });
        
        // تهيئة الرسم البياني لتوزيع شركات الطيران
        var distributionChartCanvas = document.getElementById('airlineDistributionChart').getContext('2d');
        var distributionData = {
            labels: ['الخطوط السعودية', 'طيران الإمارات', 'الاتحاد للطيران', 'مصر للطيران', 'الخطوط القطرية', 'أخرى'],
            datasets: [{
                data: [35, 20, 15, 10, 12, 8],
                backgroundColor: ['#f56954', '#00a65a', '#f39c12', '#00c0ef', '#3c8dbc', '#d2d6de']
            }]
        };
        
        var distributionOptions = {
            maintainAspectRatio: false,
            responsive: true,
            legend: {
                position: 'right',
                rtl: true,
                labels: {
                    fontFamily: 'Tajawal, sans-serif'
                }
            }
        };
        
        new Chart(distributionChartCanvas, {
            type: 'pie',
            data: distributionData,
            options: distributionOptions
        });
        
        // تحديث المبلغ المتبقي عند تغيير الدفعة المقدمة
        document.getElementById('down_payment').addEventListener('input', updateRemainingAmount);
        
        // معالجة طريقة الدفع
        document.getElementById('payment_method').addEventListener('change', handlePaymentMethod);
        
        // معالجة اختيار نوع الرحلة
        const flightTypeOptions = document.querySelectorAll('.flight-type-option');
        flightTypeOptions.forEach(option => {
            option.addEventListener('click', function() {
                // إزالة التحديد من جميع الخيارات
                flightTypeOptions.forEach(opt => opt.classList.remove('selected-flight-type'));
                // إضافة التحديد للخيار المحدد
                this.classList.add('selected-flight-type');
                
                // التعامل مع حقول تاريخ العودة ورحلات العودة
                const flightType = this.getAttribute('data-flight-type');
                const returnDateField = document.querySelector('.return-date-field');
                const returnFlights = document.querySelector('.return-flights');
                
                if (flightType === 'roundtrip') {
                    if (returnDateField) returnDateField.style.display = 'block';
                    if (returnFlights) returnFlights.style.display = 'block';
                } else {
                    if (returnDateField) returnDateField.style.display = 'none';
                    if (returnFlights) returnFlights.style.display = 'none';
                }
            });
        });
        
        // معالجة تقديم النموذج
        document.getElementById('airline-ticket-form').addEventListener('submit', function(e) {
            e.preventDefault();
            // هنا يمكنك إضافة التحقق من صحة البيانات وإرسالها للخادم
            alert('تم حجز تذكرة الطيران بنجاح!');
            $('#modal-add-airline-ticket').modal('hide');
        });
        
        // إنشاء بطاقات المسافرين عند تغيير عدد المسافرين
        document.getElementById('adults').addEventListener('change', createPassengerCards);
        document.getElementById('children').addEventListener('change', createPassengerCards);
        document.getElementById('infants').addEventListener('change', createPassengerCards);
        
        // إنشاء بطاقات المسافرين الافتراضية
        createPassengerCards();
    });
    
    // تهيئة النموذج متعدد الخطوات
    function initializeAirlineForm() {
        // الأزرار للانتقال بين الخطوات
        const nextButtons = document.querySelectorAll('.next-step');
        const prevButtons = document.querySelectorAll('.prev-step');
        
        // معالجة أزرار "التالي"
        nextButtons.forEach(button => {
            button.addEventListener('click', function() {
                const currentSection = this.closest('.section');
                const nextSectionId = this.getAttribute('data-next');
                const nextSection = document.getElementById(nextSectionId);
                
                if (validateSection(currentSection)) {
                    // إخفاء القسم الحالي وإظهار القسم التالي
                    currentSection.style.display = 'none';
                    nextSection.style.display = 'block';
                    
                    // تحديث شريط التقدم ومؤشرات الخطوات
                    updateProgress(nextSectionId);
                }
            });
        });
        
        // معالجة أزرار "السابق"
        prevButtons.forEach(button => {
            button.addEventListener('click', function() {
                const currentSection = this.closest('.section');
                const prevSectionId = this.getAttribute('data-prev');
                const prevSection = document.getElementById(prevSectionId);
                
                // إخفاء القسم الحالي وإظهار القسم السابق
                currentSection.style.display = 'none';
                prevSection.style.display = 'block';
                
                // تحديث شريط التقدم ومؤشرات الخطوات
                updateProgress(prevSectionId);
            });
        });
    }
    
    // التحقق من صحة بيانات القسم
    function validateSection(section) {
        const requiredFields = section.querySelectorAll('[required]');
        let isValid = true;
        
        requiredFields.forEach(field => {
            if (!field.value) {
                field.classList.add('is-invalid');
                isValid = false;
            } else {
                field.classList.remove('is-invalid');
            }
        });
        
        if (!isValid) {
            alert('يرجى إكمال جميع الحقول المطلوبة');
        }
        
        return isValid;
    }
    
    // تحديث شريط التقدم ومؤشرات الخطوات
    function updateProgress(sectionId) {
        const stepMatch = sectionId.match(/section-(\w+)/);
        if (!stepMatch) return;
        
        let step = 1;
        switch (stepMatch[1]) {
            case 'flight-type': step = 1; break;
            case 'passenger-details': step = 2; break;
            case 'flight-details': step = 3; break;
            case 'payment': step = 4; break;
        }
        
        // تحديث شريط التقدم
        const progressBar = document.querySelector('.progress-bar');
        const progressPercentage = (step / 4) * 100;
        progressBar.style.width = progressPercentage + '%';
        progressBar.setAttribute('aria-valuenow', progressPercentage);
        
        // تحديث مؤشرات الخطوات
        const stepIndicators = document.querySelectorAll('.step-indicator');
        stepIndicators.forEach((indicator, index) => {
            if (index < step) {
                indicator.classList.add('active');
            } else {
                indicator.classList.remove('active');
            }
        });
    }
    
    // إنشاء بطاقات المسافرين
    function createPassengerCards() {
        const adultsCount = parseInt(document.getElementById('adults').value) || 0;
        const childrenCount = parseInt(document.getElementById('children').value) || 0;
        const infantsCount = parseInt(document.getElementById('infants').value) || 0;
        
        const passengersContainer = document.getElementById('passengers-container');
        passengersContainer.innerHTML = '';
        
        // إنشاء بطاقات البالغين
        for (let i = 1; i <= adultsCount; i++) {
            createPassengerCard('adult', i);
        }
        
        // إنشاء بطاقات الأطفال
        for (let i = 1; i <= childrenCount; i++) {
            createPassengerCard('child', i);
        }
        
        // إنشاء بطاقات الرضع
        for (let i = 1; i <= infantsCount; i++) {
            createPassengerCard('infant', i);
        }
    }
    
    // إنشاء بطاقة مسافر
    function createPassengerCard(type, index) {
        const passengersContainer = document.getElementById('passengers-container');
        
        let typeText = '';
        let typeIcon = '';
        
        switch (type) {
            case 'adult':
                typeText = 'بالغ';
                typeIcon = 'fas fa-user';
                break;
            case 'child':
                typeText = 'طفل';
                typeIcon = 'fas fa-child';
                break;
            case 'infant':
                typeText = 'رضيع';
                typeIcon = 'fas fa-baby';
                break;
        }
        
        const passengerCard = document.createElement('div');
        passengerCard.className = 'passenger-card mb-4';
        passengerCard.innerHTML = `
            <h5><i class="${typeIcon} ml-2"></i>${typeText} #${index}</h5>
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="${type}_first_name_${index}">الاسم الأول <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="${type}_first_name_${index}" placeholder="الاسم الأول" required>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="${type}_last_name_${index}">اسم العائلة <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="${type}_last_name_${index}" placeholder="اسم العائلة" required>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="${type}_birth_date_${index}">تاريخ الميلاد ${type === 'adult' ? '' : '<span class="text-danger">*</span>'}</label>
                        <input type="date" class="form-control" id="${type}_birth_date_${index}" ${type !== 'adult' ? 'required' : ''}>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="${type}_nationality_${index}">الجنسية <span class="text-danger">*</span></label>
                        <select class="form-control" id="${type}_nationality_${index}" required>
                            <option value="">اختر الجنسية</option>
                            <option value="saudi">سعودي</option>
                            <option value="egyptian">مصري</option>
                            <option value="jordanian">أردني</option>
                            <option value="syrian">سوري</option>
                            <option value="yemeni">يمني</option>
                            <option value="other">أخرى</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="${type}_passport_number_${index}">رقم جواز السفر <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="${type}_passport_number_${index}" placeholder="رقم جواز السفر" required>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="${type}_passport_expiry_${index}">تاريخ انتهاء الجواز <span class="text-danger">*</span></label>
                        <input type="date" class="form-control" id="${type}_passport_expiry_${index}" required>
                    </div>
                </div>
            </div>
        `;
        
        passengersContainer.appendChild(passengerCard);
    }
    
    // تحديث المبلغ المتبقي
    function updateRemainingAmount() {
        const totalAmount = 1250; // في التطبيق الفعلي، ستحسب هذا بناءً على التذاكر المختارة
        const downPaymentElement = document.getElementById('down_payment');
        if (downPaymentElement) {
            const downPayment = parseFloat(downPaymentElement.value) || 0;
            const remainingAmount = totalAmount - downPayment;
            
            const remainingElement = document.getElementById('remaining_amount');
            if (remainingElement) {
                remainingElement.value = remainingAmount.toFixed(2);
            }
            
            // تحديث المبلغ بالكلمات
            const wordsElement = document.getElementById('down_payment_words');
            if (wordsElement && downPayment > 0) {
                wordsElement.textContent = convertNumberToArabicWords(downPayment) + ' ريالاً سعودياً';
            } else if (wordsElement) {
                wordsElement.textContent = '';
            }
        }
    }
    
    // تحويل الرقم إلى كلمات عربية
    function convertNumberToArabicWords(number) {
        const arabicOnes = ['', 'واحد', 'اثنان', 'ثلاثة', 'أربعة', 'خمسة', 'ستة', 'سبعة', 'ثمانية', 'تسعة', 'عشرة', 'أحد عشر', 'اثنا عشر', 'ثلاثة عشر', 'أربعة عشر', 'خمسة عشر', 'ستة عشر', 'سبعة عشر', 'ثمانية عشر', 'تسعة عشر'];
        const arabicTens = ['', 'عشرة', 'عشرون', 'ثلاثون', 'أربعون', 'خمسون', 'ستون', 'سبعون', 'ثمانون', 'تسعون'];
        const arabicHundreds = ['', 'مائة', 'مئتان', 'ثلاثمائة', 'أربعمائة', 'خمسمائة', 'ستمائة', 'سبعمائة', 'ثمانمائة', 'تسعمائة'];
        const arabicThousands = ['', 'ألف', 'ألفان', 'ثلاثة آلاف', 'أربعة آلاف', 'خمسة آلاف', 'ستة آلاف', 'سبعة آلاف', 'ثمانية آلاف', 'تسعة آلاف'];
        
        // تقريب الرقم إلى رقمين عشريين
        number = Math.round(number * 100) / 100;
        
        if (number === 0) return 'صفر';
        
        const integerPart = Math.floor(number);
        const decimalPart = Math.round((number - integerPart) * 100);
        
        let result = '';
        
        if (integerPart >= 1000) {
            const thousands = Math.floor(integerPart / 1000);
            if (thousands <= 10) {
                result += arabicThousands[thousands] + ' ';
            } else {
                result += convertNumberToArabicWords(thousands) + ' ألف ';
            }
            
            if (integerPart % 1000 !== 0) {
                result += 'و';
            }
        }
        
        const remainder = integerPart % 1000;
        
        if (remainder >= 100) {
            const hundreds = Math.floor(remainder / 100);
            result += arabicHundreds[hundreds] + ' ';
            
            if (remainder % 100 !== 0) {
                result += 'و';
            }
        }
        
        const tensAndOnes = remainder % 100;
        
        if (tensAndOnes > 0 && tensAndOnes < 20) {
            result += arabicOnes[tensAndOnes] + ' ';
        } else if (tensAndOnes >= 20) {
            const ones = tensAndOnes % 10;
            const tens = Math.floor(tensAndOnes / 10);
            
            if (ones > 0) {
                result += arabicOnes[ones] + ' و';
            }
            
            result += arabicTens[tens] + ' ';
        }
        
        // إضافة الكسور (الهللات)
        if (decimalPart > 0) {
            result += 'و';
            if (decimalPart < 20) {
                result += arabicOnes[decimalPart] + ' هللة';
            } else {
                const decimalOnes = decimalPart % 10;
                const decimalTens = Math.floor(decimalPart / 10);
                
                if (decimalOnes > 0) {
                    result += arabicOnes[decimalOnes] + ' و';
                }
                
                result += arabicTens[decimalTens] + ' هللة';
            }
        }
        
        return result.trim();
    }
    
    // معالجة طريقة الدفع
    function handlePaymentMethod() {
        const paymentMethodElement = document.getElementById('payment_method');
        if (!paymentMethodElement) return;
        
        const paymentMethod = paymentMethodElement.value;
        
        // إخفاء جميع تفاصيل الدفع
        const cashDetails = document.querySelector('.payment-details-cash');
        const bankDetails = document.querySelector('.payment-details-bank');
        const creditDetails = document.querySelector('.payment-details-credit');
        
        if (cashDetails) cashDetails.style.display = 'none';
        if (bankDetails) bankDetails.style.display = 'none';
        if (creditDetails) creditDetails.style.display = 'none';
        
        // إظهار التفاصيل المناسبة حسب طريقة الدفع المختارة
        if (paymentMethod === 'cash' && cashDetails) {
            cashDetails.style.display = 'block';
        } else if (paymentMethod === 'bank-transfer' && bankDetails) {
            bankDetails.style.display = 'block';
        } else if (paymentMethod === 'customer-account' && creditDetails) {
            creditDetails.style.display = 'block';
        }
    }
</script>
{% endblock %}