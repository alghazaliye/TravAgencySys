{% extends 'layout.html' %}

{% block title %}إعدادات النظام{% endblock %}

{% block styles %}
<style>
    .settings-section {
        background-color: #fff;
        border-radius: 5px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        padding: 20px;
        margin-bottom: 20px;
    }
    
    .settings-section h3 {
        border-bottom: 1px solid #e3e6f0;
        padding-bottom: 10px;
        margin-bottom: 20px;
        color: #334152;
    }
    
    .color-preview {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        display: inline-block;
        margin-right: 10px;
        border: 1px solid #ddd;
        vertical-align: middle;
    }
    
    .icon-option {
        display: inline-block;
        padding: 10px;
        margin: 5px;
        border: 1px solid #ddd;
        border-radius: 5px;
        cursor: pointer;
        text-align: center;
        width: 60px;
    }
    
    .icon-option i {
        font-size: 20px;
        color: #4e73df;
    }
    
    .icon-option.selected {
        background-color: #e8f0fe;
        border-color: #4e73df;
    }
    
    .settings-preview {
        background-color: #fff;
        border-radius: 5px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        padding: 20px;
        margin-top: 20px;
        text-align: center;
    }
    
    .preview-title {
        font-size: 24px;
        margin-bottom: 10px;
        color: var(--primary-color, #4e73df);
    }
    
    .preview-slogan {
        font-size: 16px;
        color: #6c757d;
        margin-bottom: 15px;
    }
    
    .preview-logo {
        font-size: 36px;
        margin-bottom: 20px;
        color: var(--primary-color, #4e73df);
    }
    
    .preview-buttons {
        margin-top: 20px;
    }
    
    .preview-button {
        display: inline-block;
        padding: 8px 16px;
        margin: 0 5px;
        border-radius: 4px;
        font-size: 14px;
        color: white;
    }
    
    .primary-button {
        background-color: var(--primary-color, #4e73df);
    }
    
    .secondary-button {
        background-color: var(--secondary-color, #1cc88a);
    }
    
    .date-format-example {
        background-color: #f8f9fa;
        padding: 10px 15px;
        border-radius: 5px;
        border: 1px solid #e3e6f0;
        margin-top: 8px;
        font-size: 14px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- عنوان الصفحة -->
    <div class="d-sm-flex align-items-center justify-content-between mb-4">
        <h1 class="h3 mb-0 text-gray-800">إعدادات النظام</h1>
    </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <div class="row">
        <div class="col-lg-8">
            <form method="post" enctype="multipart/form-data">
                <!-- إعدادات عامة للنظام -->
                <div class="settings-section">
                    <h3><i class="fas fa-cogs ml-2"></i>الإعدادات العامة</h3>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="system_name">اسم النظام</label>
                                <input type="text" class="form-control" id="system_name" name="system_name" 
                                    value="{{ settings.system_name }}" placeholder="أدخل اسم النظام">
                                <small class="form-text text-muted">{{ setting_descriptions.system_name.description }}</small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="system_slogan">شعار النظام</label>
                                <input type="text" class="form-control" id="system_slogan" name="system_slogan" 
                                    value="{{ settings.system_slogan }}" placeholder="أدخل شعار النظام">
                                <small class="form-text text-muted">{{ setting_descriptions.system_slogan.description }}</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="dashboard_title">عنوان لوحة التحكم</label>
                                <input type="text" class="form-control" id="dashboard_title" name="dashboard_title" 
                                    value="{{ settings.dashboard_title }}" placeholder="أدخل عنوان لوحة التحكم">
                                <small class="form-text text-muted">{{ setting_descriptions.dashboard_title.description }}</small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="default_currency">العملة الافتراضية</label>
                                <select class="form-control" id="default_currency" name="default_currency">
                                    {% for option in setting_descriptions.default_currency.options.split(',') %}
                                        <option value="{{ option }}" {% if settings.default_currency == option %}selected{% endif %}>
                                            {% if option == 'SAR' %}ريال سعودي (SAR)
                                            {% elif option == 'USD' %}دولار أمريكي (USD)
                                            {% elif option == 'EUR' %}يورو (EUR)
                                            {% elif option == 'YER' %}ريال يمني (YER)
                                            {% else %}{{ option }}{% endif %}
                                        </option>
                                    {% endfor %}
                                </select>
                                <small class="form-text text-muted">{{ setting_descriptions.default_currency.description }}</small>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- إعدادات المظهر والألوان -->
                <div class="settings-section">
                    <h3><i class="fas fa-palette ml-2"></i>المظهر والألوان</h3>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="primary_color">
                                    <span class="color-preview" id="primary_color_preview" style="background-color: {{ settings.primary_color }};"></span>
                                    اللون الرئيسي
                                </label>
                                <input type="color" class="form-control" id="primary_color" name="primary_color" 
                                    value="{{ settings.primary_color }}">
                                <small class="form-text text-muted">{{ setting_descriptions.primary_color.description }}</small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="secondary_color">
                                    <span class="color-preview" id="secondary_color_preview" style="background-color: {{ settings.secondary_color }};"></span>
                                    اللون الثانوي
                                </label>
                                <input type="color" class="form-control" id="secondary_color" name="secondary_color" 
                                    value="{{ settings.secondary_color }}">
                                <small class="form-text text-muted">{{ setting_descriptions.secondary_color.description }}</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <div class="custom-control custom-switch mb-3">
                            <input type="checkbox" class="custom-control-input" id="use_custom_logo" name="use_custom_logo" 
                                {% if settings.use_custom_logo == 'true' %}checked{% endif %}>
                            <label class="custom-control-label" for="use_custom_logo">استخدام شعار مخصص</label>
                            <small class="form-text text-muted d-block">{{ setting_descriptions.use_custom_logo.description }}</small>
                        </div>
                    </div>
                    
                    <div id="logo_icon_container" class="form-group" {% if settings.use_custom_logo == 'true' %}style="display: none;"{% endif %}>
                        <label>أيقونة الشعار</label>
                        <input type="hidden" id="logo_icon" name="logo_icon" value="{{ settings.logo_icon }}">
                        <div class="icon-options">
                            {% for icon in icon_options %}
                                <div class="icon-option {% if settings.logo_icon == icon %}selected{% endif %}" data-icon="{{ icon }}">
                                    <i class="{{ icon }}"></i>
                                    <div class="small mt-1">{{ icon.split(' ')[1] }}</div>
                                </div>
                            {% endfor %}
                        </div>
                        <small class="form-text text-muted">{{ setting_descriptions.logo_icon.description }}</small>
                    </div>
                    
                    <div id="custom_logo_container" class="form-group" {% if settings.use_custom_logo != 'true' %}style="display: none;"{% endif %}>
                        <label for="custom_logo_url">رابط الشعار المخصص</label>
                        <input type="text" class="form-control" id="custom_logo_url" name="custom_logo_url" 
                            value="{{ settings.custom_logo_url }}" placeholder="أدخل رابط الشعار المخصص">
                        <small class="form-text text-muted">{{ setting_descriptions.custom_logo_url.description }}</small>
                        <!-- معاينة الشعار المخصص -->
                        {% if settings.custom_logo_url %}
                        <div class="text-center mt-2">
                            <img src="{{ settings.custom_logo_url }}" alt="معاينة الشعار" style="max-height: 60px; max-width: 200px;">
                        </div>
                        {% endif %}
                    </div>
                    
                    <div class="form-group">
                        <label for="dark_mode">وضع العرض (ليلي/نهاري)</label>
                        <select class="form-control" id="dark_mode" name="dark_mode">
                            {% for option in setting_descriptions.dark_mode.options.split(',') %}
                                <option value="{{ option }}" {% if settings.dark_mode == option %}selected{% endif %}>
                                    {% if option == 'light' %}نهاري
                                    {% elif option == 'dark' %}ليلي
                                    {% elif option == 'auto' %}تلقائي (وفقاً لإعدادات الجهاز)
                                    {% else %}{{ option }}{% endif %}
                                </option>
                            {% endfor %}
                        </select>
                        <small class="form-text text-muted">{{ setting_descriptions.dark_mode.description }}</small>
                    </div>
                    
                    <div class="row mt-4" id="dark_mode_colors" {% if settings.dark_mode == 'light' %}style="display: none;"{% endif %}>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="dark_primary_color">
                                    <span class="color-preview" id="dark_primary_color_preview" style="background-color: {{ settings.dark_primary_color }};"></span>
                                    اللون الرئيسي (الوضع الليلي)
                                </label>
                                <input type="color" class="form-control" id="dark_primary_color" name="dark_primary_color" 
                                    value="{{ settings.dark_primary_color }}">
                                <small class="form-text text-muted">{{ setting_descriptions.dark_primary_color.description }}</small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="dark_text_color">
                                    <span class="color-preview" id="dark_text_color_preview" style="background-color: {{ settings.dark_text_color }};"></span>
                                    لون النص (الوضع الليلي)
                                </label>
                                <input type="color" class="form-control" id="dark_text_color" name="dark_text_color" 
                                    value="{{ settings.dark_text_color }}">
                                <small class="form-text text-muted">{{ setting_descriptions.dark_text_color.description }}</small>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- إعدادات شريط التنقل -->
                <div class="settings-section">
                    <h3><i class="fas fa-bars ml-2"></i>إعدادات شريط التنقل</h3>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="navbar_color">
                                    <span class="color-preview" id="navbar_color_preview" style="background-color: {{ settings.navbar_color }};"></span>
                                    لون خلفية شريط التنقل
                                </label>
                                <input type="color" class="form-control" id="navbar_color" name="navbar_color" 
                                    value="{{ settings.navbar_color }}">
                                <small class="form-text text-muted">{{ setting_descriptions.navbar_color.description }}</small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="navbar_text_color">
                                    <span class="color-preview" id="navbar_text_color_preview" style="background-color: {{ settings.navbar_text_color }};"></span>
                                    لون النص في شريط التنقل
                                </label>
                                <input type="color" class="form-control" id="navbar_text_color" name="navbar_text_color" 
                                    value="{{ settings.navbar_text_color }}">
                                <small class="form-text text-muted">{{ setting_descriptions.navbar_text_color.description }}</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="navbar_dark_color">
                                    <span class="color-preview" id="navbar_dark_color_preview" style="background-color: {{ settings.navbar_dark_color }};"></span>
                                    لون خلفية شريط التنقل (الوضع الليلي)
                                </label>
                                <input type="color" class="form-control" id="navbar_dark_color" name="navbar_dark_color" 
                                    value="{{ settings.navbar_dark_color }}">
                                <small class="form-text text-muted">{{ setting_descriptions.navbar_dark_color.description }}</small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="navbar_dark_text_color">
                                    <span class="color-preview" id="navbar_dark_text_color_preview" style="background-color: {{ settings.navbar_dark_text_color }};"></span>
                                    لون النص في شريط التنقل (الوضع الليلي)
                                </label>
                                <input type="color" class="form-control" id="navbar_dark_text_color" name="navbar_dark_text_color" 
                                    value="{{ settings.navbar_dark_text_color }}">
                                <small class="form-text text-muted">{{ setting_descriptions.navbar_dark_text_color.description }}</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row mt-3">
                        <div class="col-md-4">
                            <div class="form-group form-check">
                                <input type="checkbox" class="form-check-input" id="navbar_fixed" name="navbar_fixed" value="true"
                                    {% if settings.navbar_fixed == 'true' %}checked{% endif %}>
                                <label class="form-check-label" for="navbar_fixed">تثبيت شريط التنقل عند التمرير</label>
                                <small class="form-text text-muted d-block">{{ setting_descriptions.navbar_fixed.description }}</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group form-check">
                                <input type="checkbox" class="form-check-input" id="navbar_transparent" name="navbar_transparent" value="true"
                                    {% if settings.navbar_transparent == 'true' %}checked{% endif %}>
                                <label class="form-check-label" for="navbar_transparent">شريط تنقل شفاف</label>
                                <small class="form-text text-muted d-block">{{ setting_descriptions.navbar_transparent.description }}</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group form-check">
                                <input type="checkbox" class="form-check-input" id="navbar_shadow" name="navbar_shadow" value="true"
                                    {% if settings.navbar_shadow == 'true' %}checked{% endif %}>
                                <label class="form-check-label" for="navbar_shadow">إظهار ظل لشريط التنقل</label>
                                <small class="form-text text-muted d-block">{{ setting_descriptions.navbar_shadow.description }}</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-3">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle ml-2"></i>
                            يمكنك تخصيص مظهر شريط التنقل العلوي بما يتناسب مع هوية الشركة. التغييرات ستظهر مباشرة بعد حفظ الإعدادات.
                        </div>
                    </div>
                </div>
                
                <!-- إعدادات الشكل العام -->
                <div class="settings-section">
                    <h3><i class="fas fa-desktop ml-2"></i>إعدادات الشكل العام</h3>
                    
                    <div class="row mt-3">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="content_width">عرض المحتوى</label>
                                <select class="form-control" id="content_width" name="content_width">
                                    {% for option in setting_descriptions.content_width.options.split(',') %}
                                        <option value="{{ option }}" {% if settings.content_width == option %}selected{% endif %}>
                                            {% if option == 'fluid' %}سلس (مرن)
                                            {% elif option == 'fixed' %}ثابت
                                            {% else %}{{ option }}{% endif %}
                                        </option>
                                    {% endfor %}
                                </select>
                                <small class="form-text text-muted">{{ setting_descriptions.content_width.description }}</small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="border_radius">انحناء الحواف</label>
                                <select class="form-control" id="border_radius" name="border_radius">
                                    {% for option in setting_descriptions.border_radius.options.split(',') %}
                                        <option value="{{ option }}" {% if settings.border_radius == option %}selected{% endif %}>
                                            {% if option == 'none' %}بدون انحناء
                                            {% elif option == 'small' %}انحناء صغير
                                            {% elif option == 'medium' %}انحناء متوسط
                                            {% elif option == 'large' %}انحناء كبير
                                            {% else %}{{ option }}{% endif %}
                                        </option>
                                    {% endfor %}
                                </select>
                                <small class="form-text text-muted">{{ setting_descriptions.border_radius.description }}</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="card_shadow">ظل البطاقات</label>
                                <select class="form-control" id="card_shadow" name="card_shadow">
                                    {% for option in setting_descriptions.card_shadow.options.split(',') %}
                                        <option value="{{ option }}" {% if settings.card_shadow == option %}selected{% endif %}>
                                            {% if option == 'none' %}بدون ظل
                                            {% elif option == 'small' %}ظل خفيف
                                            {% elif option == 'medium' %}ظل متوسط
                                            {% elif option == 'large' %}ظل كبير
                                            {% else %}{{ option }}{% endif %}
                                        </option>
                                    {% endfor %}
                                </select>
                                <small class="form-text text-muted">{{ setting_descriptions.card_shadow.description }}</small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group form-check mt-4">
                                <input type="checkbox" class="form-check-input" id="transitions" name="transitions" value="true"
                                    {% if settings.transitions == 'true' %}checked{% endif %}>
                                <label class="form-check-label" for="transitions">تفعيل التأثيرات الحركية</label>
                                <small class="form-text text-muted d-block">{{ setting_descriptions.transitions.description }}</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row mt-3">
                        <div class="col-md-6">
                            <div class="form-group form-check">
                                <input type="checkbox" class="form-check-input" id="layout_boxed" name="layout_boxed" value="true"
                                    {% if settings.layout_boxed == 'true' %}checked{% endif %}>
                                <label class="form-check-label" for="layout_boxed">تخطيط مضغوط للشاشة</label>
                                <small class="form-text text-muted d-block">{{ setting_descriptions.layout_boxed.description }}</small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group form-check">
                                <input type="checkbox" class="form-check-input" id="sidebar_mini" name="sidebar_mini" value="true"
                                    {% if settings.sidebar_mini == 'true' %}checked{% endif %}>
                                <label class="form-check-label" for="sidebar_mini">استخدام القائمة الجانبية المصغرة</label>
                                <small class="form-text text-muted d-block">{{ setting_descriptions.sidebar_mini.description }}</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <div class="card">
                            <div class="card-header bg-travel-info text-white">
                                <h5 class="mb-0">معاينة الشكل العام</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div id="preview_card" class="card mb-0" style="box-shadow: 0 4px 10px rgba(0,0,0,0.1); border-radius: 8px;">
                                            <div class="card-header bg-travel-primary">
                                                <h6 class="text-white mb-0">معاينة البطاقة</h6>
                                            </div>
                                            <div class="card-body">
                                                <p>هذه هي معاينة لشكل البطاقات وفقاً للإعدادات المحددة. ستتغير تلقائياً عند تغيير الإعدادات.</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div id="layout_preview" class="text-center p-3 border" style="min-height: 150px; background-color: #f8f9fc; border-radius: 5px;">
                                            <div id="preview_header" class="mb-2 p-2 bg-primary text-white" style="border-radius: 5px;">شريط التنقل</div>
                                            <div class="d-flex">
                                                <div id="preview_sidebar" class="mr-2 p-2 bg-secondary text-white" style="width: 20%; border-radius: 5px;">القائمة</div>
                                                <div id="preview_content" class="p-2 bg-white" style="width: 80%; border-radius: 5px;">محتوى الصفحة</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- إعدادات التاريخ -->
                <div class="settings-section">
                    <h3><i class="fas fa-calendar-alt ml-2"></i>إعدادات التاريخ</h3>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="date_format">صيغة عرض التاريخ</label>
                                <select class="form-control" id="date_format" name="date_format">
                                    {% for option in setting_descriptions.date_format.options.split(',') %}
                                        <option value="{{ option }}" {% if settings.date_format == option %}selected{% endif %}>
                                            {{ option }}
                                        </option>
                                    {% endfor %}
                                </select>
                                <small class="form-text text-muted">{{ setting_descriptions.date_format.description }}</small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group mt-4">
                                <div class="date-format-example">
                                    <span>مثال:</span>
                                    <span id="date_format_example">15/05/2023</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <div class="custom-control custom-switch">
                            <input type="checkbox" class="custom-control-input" id="use_hijri_dates" name="use_hijri_dates" 
                                {% if settings.use_hijri_dates == 'true' %}checked{% endif %}>
                            <label class="custom-control-label" for="use_hijri_dates">استخدام التاريخ الهجري بدلاً من الميلادي</label>
                        </div>
                        <small class="form-text text-muted">{{ setting_descriptions.use_hijri_dates.description }}</small>
                    </div>
                    
                    <div class="form-group">
                        <div class="custom-control custom-switch">
                            <input type="checkbox" class="custom-control-input" id="show_both_dates" name="show_both_dates" 
                                {% if settings.show_both_dates == 'true' %}checked{% endif %}>
                            <label class="custom-control-label" for="show_both_dates">عرض التاريخ الهجري والميلادي معاً</label>
                        </div>
                        <small class="form-text text-muted">{{ setting_descriptions.show_both_dates.description }}</small>
                    </div>
                </div>
                
                <!-- إعدادات الإشعارات -->
                <div class="settings-section">
                    <h3><i class="fas fa-bell ml-2"></i>إعدادات الإشعارات</h3>
                    
                    <div class="form-group">
                        <div class="custom-control custom-switch">
                            <input type="checkbox" class="custom-control-input" id="show_notifications" name="show_notifications" 
                                {% if settings.show_notifications == 'true' %}checked{% endif %}>
                            <label class="custom-control-label" for="show_notifications">إظهار الإشعارات في الشريط العلوي</label>
                        </div>
                        <small class="form-text text-muted">{{ setting_descriptions.show_notifications.description }}</small>
                    </div>
                    
                    <div class="form-group">
                        <div class="custom-control custom-switch">
                            <input type="checkbox" class="custom-control-input" id="enable_emails" name="enable_emails" 
                                {% if settings.enable_emails == 'true' %}checked{% endif %}>
                            <label class="custom-control-label" for="enable_emails">تفعيل إرسال الإشعارات عبر البريد الإلكتروني</label>
                        </div>
                        <small class="form-text text-muted">{{ setting_descriptions.enable_emails.description }}</small>
                    </div>
                    
                    <div class="form-group">
                        <div class="custom-control custom-switch">
                            <input type="checkbox" class="custom-control-input" id="enable_sms" name="enable_sms" 
                                {% if settings.enable_sms == 'true' %}checked{% endif %}>
                            <label class="custom-control-label" for="enable_sms">تفعيل إرسال الإشعارات عبر الرسائل القصيرة</label>
                        </div>
                        <small class="form-text text-muted">{{ setting_descriptions.enable_sms.description }}</small>
                    </div>
                </div>
                
                <!-- أزرار الإجراءات -->
                <div class="form-group text-center">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save ml-1"></i>حفظ الإعدادات
                    </button>
                    <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">
                        <i class="fas fa-times ml-1"></i>إلغاء
                    </a>
                </div>
            </form>
        </div>
        
        <!-- معاينة الإعدادات -->
        <div class="col-lg-4">
            <div class="settings-section">
                <h3><i class="fas fa-eye ml-2"></i>معاينة الإعدادات</h3>
                
                <div class="settings-preview">
                    <div class="preview-logo">
                        <i id="preview_icon" class="{{ settings.logo_icon }}"></i>
                    </div>
                    <div class="preview-title" id="preview_title">{{ settings.system_name }}</div>
                    <div class="preview-slogan" id="preview_slogan">{{ settings.system_slogan }}</div>
                    
                    <div class="preview-buttons">
                        <span class="preview-button primary-button">زر رئيسي</span>
                        <span class="preview-button secondary-button">زر ثانوي</span>
                    </div>
                </div>
                
                <div class="mt-4">
                    <div class="alert alert-info">
                        <h5><i class="fas fa-info-circle ml-1"></i>ملاحظة</h5>
                        <p>سيتم تطبيق الإعدادات فور الحفظ على جميع صفحات النظام.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
$(document).ready(function() {
    // تحديث معاينة الألوان عند تغييرها
    $('#primary_color').on('input', function() {
        var color = $(this).val();
        $('#primary_color_preview').css('background-color', color);
        document.documentElement.style.setProperty('--primary-color', color);
        $('.preview-title, .preview-logo, .primary-button').css('color', color);
        $('.primary-button').css('background-color', color);
    });
    
    $('#secondary_color').on('input', function() {
        var color = $(this).val();
        $('#secondary_color_preview').css('background-color', color);
        document.documentElement.style.setProperty('--secondary-color', color);
        $('.secondary-button').css('background-color', color);
    });
    
    // معالجة ألوان الوضع الليلي
    $('#dark_primary_color').on('input', function() {
        var color = $(this).val();
        $('#dark_primary_color_preview').css('background-color', color);
    });
    
    $('#dark_text_color').on('input', function() {
        var color = $(this).val();
        $('#dark_text_color_preview').css('background-color', color);
    });
    
    // إدارة إعدادات الوضع الليلي
    $('#dark_mode').on('change', function() {
        var selectedMode = $(this).val();
        if (selectedMode === 'light') {
            $('#dark_mode_colors').hide();
        } else {
            $('#dark_mode_colors').show();
        }
    });
    
    // تحديث معاينة اسم النظام وشعاره
    $('#system_name').on('input', function() {
        $('#preview_title').text($(this).val());
    });
    
    $('#system_slogan').on('input', function() {
        $('#preview_slogan').text($(this).val());
    });
    
    // اختيار أيقونة الشعار
    $('.icon-option').on('click', function() {
        $('.icon-option').removeClass('selected');
        $(this).addClass('selected');
        
        var iconClass = $(this).data('icon');
        $('#logo_icon').val(iconClass);
        
        // تحديث المعاينة
        $('#preview_icon').attr('class', iconClass);
    });
    
    // التبديل بين الشعار المخصص والأيقونة
    $('#use_custom_logo').on('change', function() {
        if (this.checked) {
            $('#logo_icon_container').hide();
            $('#custom_logo_container').show();
            
            // تحديث المعاينة إذا كان هناك شعار مخصص
            if ($('#custom_logo_url').val()) {
                updateLogoPreview($('#custom_logo_url').val());
            }
        } else {
            $('#logo_icon_container').show();
            $('#custom_logo_container').hide();
            
            // إعادة عرض الأيقونة في المعاينة
            $('.preview-logo #preview_custom_logo').remove();
            $('.preview-logo #preview_icon').show();
        }
    });
    
    // تحديث معاينة الشعار المخصص عند تغيير الرابط
    $('#custom_logo_url').on('input', function() {
        var url = $(this).val();
        if (url) {
            updateLogoPreview(url);
        } else {
            // إذا كان الرابط فارغًا، عرض الأيقونة الافتراضية
            $('.preview-logo #preview_custom_logo').remove();
            $('.preview-logo #preview_icon').show();
        }
    });
    
    // دالة لتحديث معاينة الشعار المخصص
    function updateLogoPreview(url) {
        // إخفاء الأيقونة
        $('.preview-logo #preview_icon').hide();
        
        // إزالة أي شعار مخصص سابق
        $('.preview-logo #preview_custom_logo').remove();
        
        // إضافة الشعار المخصص الجديد
        $('.preview-logo').append('<img id="preview_custom_logo" src="' + url + '" alt="شعار مخصص" style="max-height: 50px; max-width: 150px;">');
    }
    
    // ضبط متغيرات CSS للألوان
    document.documentElement.style.setProperty('--primary-color', $('#primary_color').val());
    document.documentElement.style.setProperty('--secondary-color', $('#secondary_color').val());
    
    // تهيئة حقل اختيار الملف
    $('.custom-file-input').on('change', function() {
        var fileName = $(this).val().split('\\').pop();
        $(this).next('.custom-file-label').html(fileName);
    });
    
    // تحديث مثال صيغة التاريخ
    function updateDateFormatExample() {
        var format = $('#date_format').val();
        var today = new Date();
        var example = '';
        
        // تنسيق التاريخ حسب الصيغة المختارة
        if (format === 'DD/MM/YYYY') {
            example = padZero(today.getDate()) + '/' + padZero(today.getMonth() + 1) + '/' + today.getFullYear();
        } else if (format === 'YYYY/MM/DD') {
            example = today.getFullYear() + '/' + padZero(today.getMonth() + 1) + '/' + padZero(today.getDate());
        } else if (format === 'DD-MM-YYYY') {
            example = padZero(today.getDate()) + '-' + padZero(today.getMonth() + 1) + '-' + today.getFullYear();
        } else if (format === 'YYYY-MM-DD') {
            example = today.getFullYear() + '-' + padZero(today.getMonth() + 1) + '-' + padZero(today.getDate());
        } else if (format === 'DD MMMM, YYYY') {
            var months = ['يناير', 'فبراير', 'مارس', 'إبريل', 'مايو', 'يونيو', 'يوليو', 'أغسطس', 'سبتمبر', 'أكتوبر', 'نوفمبر', 'ديسمبر'];
            example = padZero(today.getDate()) + ' ' + months[today.getMonth()] + ', ' + today.getFullYear();
        }
        
        // عرض المثال
        $('#date_format_example').text(example);
        
        // تحديث مثال التاريخ الهجري إذا كان مفعلاً
        if ($('#use_hijri_dates').is(':checked') || $('#show_both_dates').is(':checked')) {
            // هنا يمكن إضافة كود تحويل التاريخ الميلادي إلى هجري
            // لنفرض أن هناك دالة تحويل اسمها convertToHijri
            if ($('#show_both_dates').is(':checked')) {
                var hijriExample = example + ' / 15 شوال 1444';
                $('#date_format_example').text(hijriExample);
            } else {
                $('#date_format_example').text('15 شوال 1444');
            }
        }
    }
    
    // دالة مساعدة لإضافة صفر قبل الأرقام الأحادية
    function padZero(num) {
        return (num < 10 ? '0' : '') + num;
    }
    
    // تحديث المثال عند تغيير صيغة التاريخ
    $('#date_format').on('change', updateDateFormatExample);
    
    // تحديث المثال عند تغيير إعدادات التاريخ الهجري
    $('#use_hijri_dates, #show_both_dates').on('change', function() {
        // تفعيل/تعطيل خيار عرض التاريخين معاً حسب حالة استخدام التاريخ الهجري
        if ($('#use_hijri_dates').is(':checked')) {
            $('#show_both_dates').prop('disabled', false);
        } else {
            $('#show_both_dates').prop('checked', false).prop('disabled', true);
        }
        
        updateDateFormatExample();
    });
    
    // تحديث المثال عند تحميل الصفحة
    updateDateFormatExample();
    
    // تفعيل/تعطيل خيار عرض التاريخين معاً عند تحميل الصفحة
    if (!$('#use_hijri_dates').is(':checked')) {
        $('#show_both_dates').prop('disabled', true);
    }
    
    // تهيئة معاينة الشعار المخصص عند تحميل الصفحة
    if ($('#use_custom_logo').is(':checked') && $('#custom_logo_url').val()) {
        updateLogoPreview($('#custom_logo_url').val());
    }
    
    // تهيئة إظهار/إخفاء خيارات الوضع الليلي عند تحميل الصفحة
    if ($('#dark_mode').val() === 'light') {
        $('#dark_mode_colors').hide();
    }
    
    // تحديث معاينة ألوان شريط التنقل
    $('#navbar_color').on('input', function() {
        var color = $(this).val();
        $('#navbar_color_preview').css('background-color', color);
    });
    
    $('#navbar_text_color').on('input', function() {
        var color = $(this).val();
        $('#navbar_text_color_preview').css('background-color', color);
    });
    
    $('#navbar_dark_color').on('input', function() {
        var color = $(this).val();
        $('#navbar_dark_color_preview').css('background-color', color);
    });
    
    $('#navbar_dark_text_color').on('input', function() {
        var color = $(this).val();
        $('#navbar_dark_text_color_preview').css('background-color', color);
    });
    
    // تحديث معاينة إعدادات الشكل العام
    function updateLayoutPreview() {
        // تحديث حجم ظل البطاقة
        var shadowSize = $('#card_shadow').val();
        var shadowValue = '0 0 0 rgba(0,0,0,0)';
        
        if (shadowSize === 'small') {
            shadowValue = '0 2px 5px rgba(0,0,0,0.1)';
        } else if (shadowSize === 'medium') {
            shadowValue = '0 4px 10px rgba(0,0,0,0.15)';
        } else if (shadowSize === 'large') {
            shadowValue = '0 8px 20px rgba(0,0,0,0.2)';
        }
        
        $('#preview_card').css('box-shadow', shadowValue);
        
        // تحديث انحناء الحواف
        var borderRadius = $('#border_radius').val();
        var radiusValue = '0';
        
        if (borderRadius === 'small') {
            radiusValue = '4px';
        } else if (borderRadius === 'medium') {
            radiusValue = '8px';
        } else if (borderRadius === 'large') {
            radiusValue = '16px';
        }
        
        $('#preview_card, #preview_header, #preview_sidebar, #preview_content').css('border-radius', radiusValue);
        
        // تحديث عرض المحتوى
        if ($('#content_width').val() === 'fixed') {
            $('#layout_preview').addClass('container-narrow').removeClass('container-fluid');
            $('#preview_content').css('width', '70%');
        } else {
            $('#layout_preview').removeClass('container-narrow').addClass('container-fluid');
            $('#preview_content').css('width', '80%');
        }
        
        // تحديث تخطيط مضغوط
        if ($('#layout_boxed').is(':checked')) {
            $('#layout_preview').addClass('boxed-layout').css('max-width', '90%').css('margin', '0 auto');
        } else {
            $('#layout_preview').removeClass('boxed-layout').css('max-width', '100%').css('margin', '0');
        }
        
        // تحديث القائمة الجانبية المصغرة
        if ($('#sidebar_mini').is(':checked')) {
            $('#preview_sidebar').css('width', '10%').text('');
            $('#preview_content').css('width', '90%');
        } else {
            $('#preview_sidebar').css('width', '20%').text('القائمة');
        }
        
        // تحديث التأثيرات الحركية
        if ($('#transitions').is(':checked')) {
            $('#preview_card, #preview_header, #preview_sidebar, #preview_content').css('transition', 'all 0.3s ease');
        } else {
            $('#preview_card, #preview_header, #preview_sidebar, #preview_content').css('transition', 'none');
        }
    }
    
    // ربط الأحداث بالعناصر
    $('#card_shadow, #border_radius, #content_width').on('change', updateLayoutPreview);
    $('#layout_boxed, #sidebar_mini, #transitions').on('change', updateLayoutPreview);
    
    // تهيئة المعاينة الأولية
    updateLayoutPreview();
});
</script>
{% endblock %}