{% extends 'layout.html' %}

{% block title %}
    حجز تذاكر الباص - نظام وكالة السفر والسياحة
{% endblock %}

{% block styles %}
<!-- DateTimePicker CSS -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.1.2/css/tempusdominus-bootstrap-4.min.css">
<!-- Select2 CSS -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/select2-bootstrap-theme/0.1.0-beta.10/select2-bootstrap.min.css">
<!-- SweetAlert2 CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
<!-- Toastr CSS -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
<!-- صفحة حجز تذاكر الباص CSS -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/bus-tickets.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/bus-tickets-form.css') }}">
{% endblock %}

{% block content %}
<!-- Content Header (Page header) -->
<div class="content-header">
    <div class="container-fluid">
        <div class="row mb-2">
            <div class="col-sm-6">
                <h1 class="m-0">
                    {% if show_booking_form %}
                    حجز تذكرة باص جديدة
                    {% else %}
                    حجز تذاكر الباص
                    {% endif %}
                </h1>
            </div><!-- /.col -->
            <div class="col-sm-6">
                <ol class="breadcrumb float-sm-left">
                    <li class="breadcrumb-item"><a href="{{ url_for("index") }}">الرئيسية</a></li>
                    <li class="breadcrumb-item">خدمات النقل</li>
                    {% if show_booking_form %}
                    <li class="breadcrumb-item"><a href="{{ url_for('bus_tickets') }}">حجز تذاكر الباص</a></li>
                    <li class="breadcrumb-item active">حجز تذكرة جديدة</li>
                    {% else %}
                    <li class="breadcrumb-item active">حجز تذاكر الباص</li>
                    {% endif %}
                </ol>
            </div><!-- /.col -->
        </div><!-- /.row -->
    </div><!-- /.container-fluid -->
</div>
<!-- /.content-header -->

<!-- Main content -->
<section class="content">
    <div class="container-fluid">
    
    <!-- نموذج حجز تذكرة باص جديدة (مخفي افتراضيًا) -->
    <div id="booking-form-container" class="card card-primary card-outline" {% if not show_booking_form %}style="display: none;"{% endif %}>
        <div class="card-header">
            <h3 class="card-title">
                <i class="fas fa-plus-circle ml-1"></i>
                حجز تذكرة باص جديدة
            </h3>
            <div class="card-tools">
                <button type="button" id="hide-booking-form" class="btn btn-sm btn-default">
                    <i class="fas fa-times"></i> إلغاء
                </button>
            </div>
        </div>
        <div class="card-body">
            <form id="bus-booking-form" action="javascript:void(0);" method="POST">
                <!-- بيانات المسافر -->
                <div class="form-section">
                    <h4 class="section-title">بيانات المسافر</h4>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="passenger-name">اسم المسافر <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="passenger-name" name="passengerName" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="mobile-number">رقم الجوال <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="mobile-number" name="mobileNumber" required>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="id-type">نوع الهوية <span class="text-danger">*</span></label>
                                <select class="form-control select2" id="id-type" name="idType" style="width: 100%;" required>
                                    <option value="">اختر نوع الهوية</option>
                                    <option value="بطاقة هوية">بطاقة هوية</option>
                                    <option value="جواز سفر">جواز سفر</option>
                                    <option value="إقامة">إقامة</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="id-number">رقم الهوية <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="id-number" name="idNumber" required>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="nationality">الجنسية <span class="text-danger">*</span></label>
                                <select class="form-control select2" id="nationality" name="nationality" style="width: 100%;" required>
                                    <option value="">اختر الجنسية</option>
                                    <option value="سعودي">سعودي</option>
                                    <option value="مصري">مصري</option>
                                    <option value="يمني">يمني</option>
                                    <option value="سوري">سوري</option>
                                    <option value="أردني">أردني</option>
                                    <option value="فلسطيني">فلسطيني</option>
                                    <option value="لبناني">لبناني</option>
                                    <option value="عراقي">عراقي</option>
                                    <option value="سوداني">سوداني</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="gender">الجنس <span class="text-danger">*</span></label>
                                <select class="form-control select2" id="gender" name="gender" style="width: 100%;" required>
                                    <option value="">اختر الجنس</option>
                                    <option value="ذكر">ذكر</option>
                                    <option value="أنثى">أنثى</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="birth-date">تاريخ الميلاد</label>
                                <div class="input-group date" id="birth-date-picker" data-target-input="nearest">
                                    <input type="text" class="form-control datetimepicker-input" data-target="#birth-date-picker" id="birth-date" name="birthDate"/>
                                    <div class="input-group-append" data-target="#birth-date-picker" data-toggle="datetimepicker">
                                        <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="issue-date">تاريخ الإصدار</label>
                                <div class="input-group date" id="issue-date-picker" data-target-input="nearest">
                                    <input type="text" class="form-control datetimepicker-input" data-target="#issue-date-picker" id="issue-date" name="issueDate"/>
                                    <div class="input-group-append" data-target="#issue-date-picker" data-toggle="datetimepicker">
                                        <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="issue-place">مكان الإصدار</label>
                                <input type="text" class="form-control" id="issue-place" name="issuePlace">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- بيانات الرحلة -->
                <div class="form-section">
                    <h4 class="section-title">بيانات الرحلة</h4>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="departure-city">مدينة المغادرة <span class="text-danger">*</span></label>
                                <select class="form-control select2" id="departure-city" name="departureCity" style="width: 100%;" required>
                                    <option value="">اختر مدينة المغادرة</option>
                                    <option value="الرياض">الرياض</option>
                                    <option value="جدة">جدة</option>
                                    <option value="مكة المكرمة">مكة المكرمة</option>
                                    <option value="المدينة المنورة">المدينة المنورة</option>
                                    <option value="الدمام">الدمام</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="destination-city">مدينة الوصول <span class="text-danger">*</span></label>
                                <select class="form-control select2" id="destination-city" name="destinationCity" style="width: 100%;" required>
                                    <option value="">اختر مدينة الوصول</option>
                                    <option value="الرياض">الرياض</option>
                                    <option value="جدة">جدة</option>
                                    <option value="مكة المكرمة">مكة المكرمة</option>
                                    <option value="المدينة المنورة">المدينة المنورة</option>
                                    <option value="الدمام">الدمام</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="journey-type">نوع الرحلة <span class="text-danger">*</span></label>
                                <select class="form-control select2" id="journey-type" name="journeyType" style="width: 100%;" required>
                                    <option value="one-way">ذهاب فقط</option>
                                    <option value="round-trip">ذهاب وعودة</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="bus-type">نوع الباص <span class="text-danger">*</span></label>
                                <select class="form-control select2" id="bus-type" name="busType" style="width: 100%;" required>
                                    <option value="">اختر نوع الباص</option>
                                    <option value="عادي">عادي</option>
                                    <option value="VIP">VIP</option>
                                    <option value="سياحي">سياحي</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="travel-purpose">الغرض من السفر</label>
                                <select class="form-control select2" id="travel-purpose" name="purpose" style="width: 100%;">
                                    <option value="">اختر الغرض</option>
                                    <option value="سياحة">سياحة</option>
                                    <option value="عمل">عمل</option>
                                    <option value="زيارة عائلية">زيارة عائلية</option>
                                    <option value="علاج">علاج</option>
                                    <option value="آخر">آخر</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="seat-number">رقم المقعد</label>
                                <input type="text" class="form-control" id="seat-number" name="seatNumber">
                                <button type="button" class="btn btn-sm btn-outline-primary mt-2" data-toggle="modal" data-target="#seat-selection-modal">
                                    <i class="fas fa-chair ml-1"></i> اختيار المقعد من الخريطة
                                </button>
                            </div>
                        </div>

<!-- نافذة منبثقة لاختيار المقعد -->
<div class="modal fade" id="seat-selection-modal" tabindex="-1" role="dialog" aria-labelledby="seatSelectionModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="seatSelectionModalLabel">اختيار المقعد</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- راهنما المقاعد -->
                <div class="seat-legend mb-4">
                    <div class="d-flex align-items-center ml-3">
                        <div class="seat mr-2"></div>
                        <span class="text">متاح</span>
                    </div>
                    <div class="d-flex align-items-center ml-3">
                        <div class="seat selected mr-2"></div>
                        <span class="text">محدد</span>
                    </div>
                    <div class="d-flex align-items-center">
                        <div class="seat reserved mr-2"></div>
                        <span class="text">محجوز</span>
                    </div>
                </div>
                
                <!-- اتجاه الباص -->
                <div class="bus-direction mb-4 text-center">
                    <div class="bus-front">
                        <i class="fas fa-steering-wheel fa-2x"></i>
                        <span>مقدمة الباص</span>
                    </div>
                </div>
                
                <!-- خريطة المقاعد -->
                <div class="bus-seat-map">
                    <div class="seat-map">
                        <!-- الصف الأول -->
                        <div class="seat-row">
                            <div class="seat" data-seat-id="1A">1A</div>
                            <div class="seat" data-seat-id="1B">1B</div>
                            <div class="seat aisle"><i class="fas fa-ellipsis-h"></i></div>
                            <div class="seat" data-seat-id="1C">1C</div>
                            <div class="seat" data-seat-id="1D">1D</div>
                        </div>
                        
                        <!-- الصف الثاني -->
                        <div class="seat-row">
                            <div class="seat" data-seat-id="2A">2A</div>
                            <div class="seat" data-seat-id="2B">2B</div>
                            <div class="seat aisle"><i class="fas fa-ellipsis-h"></i></div>
                            <div class="seat" data-seat-id="2C">2C</div>
                            <div class="seat" data-seat-id="2D">2D</div>
                        </div>
                        
                        <!-- الصف الثالث -->
                        <div class="seat-row">
                            <div class="seat" data-seat-id="3A">3A</div>
                            <div class="seat" data-seat-id="3B">3B</div>
                            <div class="seat aisle"><i class="fas fa-ellipsis-h"></i></div>
                            <div class="seat" data-seat-id="3C">3C</div>
                            <div class="seat" data-seat-id="3D">3D</div>
                        </div>
                        
                        <!-- الصف الرابع -->
                        <div class="seat-row">
                            <div class="seat" data-seat-id="4A">4A</div>
                            <div class="seat" data-seat-id="4B">4B</div>
                            <div class="seat aisle"><i class="fas fa-ellipsis-h"></i></div>
                            <div class="seat" data-seat-id="4C">4C</div>
                            <div class="seat" data-seat-id="4D">4D</div>
                        </div>
                        
                        <!-- الصف الخامس -->
                        <div class="seat-row">
                            <div class="seat" data-seat-id="5A">5A</div>
                            <div class="seat" data-seat-id="5B">5B</div>
                            <div class="seat aisle"><i class="fas fa-ellipsis-h"></i></div>
                            <div class="seat" data-seat-id="5C">5C</div>
                            <div class="seat" data-seat-id="5D">5D</div>
                        </div>
                        
                        <!-- الصف السادس -->
                        <div class="seat-row">
                            <div class="seat" data-seat-id="6A">6A</div>
                            <div class="seat" data-seat-id="6B">6B</div>
                            <div class="seat aisle"><i class="fas fa-ellipsis-h"></i></div>
                            <div class="seat" data-seat-id="6C">6C</div>
                            <div class="seat" data-seat-id="6D">6D</div>
                        </div>
                        
                        <!-- الصف السابع -->
                        <div class="seat-row">
                            <div class="seat" data-seat-id="7A">7A</div>
                            <div class="seat" data-seat-id="7B">7B</div>
                            <div class="seat aisle"><i class="fas fa-ellipsis-h"></i></div>
                            <div class="seat" data-seat-id="7C">7C</div>
                            <div class="seat" data-seat-id="7D">7D</div>
                        </div>
                        
                        <!-- الصف الثامن -->
                        <div class="seat-row">
                            <div class="seat" data-seat-id="8A">8A</div>
                            <div class="seat" data-seat-id="8B">8B</div>
                            <div class="seat aisle"><i class="fas fa-ellipsis-h"></i></div>
                            <div class="seat" data-seat-id="8C">8C</div>
                            <div class="seat" data-seat-id="8D">8D</div>
                        </div>
                        
                        <!-- الصف التاسع -->
                        <div class="seat-row">
                            <div class="seat" data-seat-id="9A">9A</div>
                            <div class="seat" data-seat-id="9B">9B</div>
                            <div class="seat aisle"><i class="fas fa-ellipsis-h"></i></div>
                            <div class="seat reserved" data-seat-id="9C">9C</div>
                            <div class="seat reserved" data-seat-id="9D">9D</div>
                        </div>
                        
                        <!-- الصف العاشر (الصف الخلفي) -->
                        <div class="seat-row">
                            <div class="seat" data-seat-id="10A">10A</div>
                            <div class="seat" data-seat-id="10B">10B</div>
                            <div class="seat" data-seat-id="10C">10C</div>
                            <div class="seat" data-seat-id="10D">10D</div>
                            <div class="seat" data-seat-id="10E">10E</div>
                        </div>
                    </div>
                </div>
                
                <!-- تفاصيل اختيار المقعد -->
                <div class="mt-4 d-flex justify-content-between align-items-center">
                    <div class="selected-seats">
                        <span class="font-weight-bold ml-2">المقاعد المحددة:</span>
                        <span id="selected-seats-list">لم يتم تحديد مقاعد</span>
                    </div>
                    
                    <div>
                        <button type="button" class="btn btn-primary" id="confirm-seat-selection">
                            <i class="fas fa-check ml-1"></i> تأكيد الاختيار
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
                    </div>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="reservation-date">تاريخ الحجز <span class="text-danger">*</span></label>
                                <div class="input-group date" id="reservation-date-picker" data-target-input="nearest">
                                    <input type="text" class="form-control datetimepicker-input" data-target="#reservation-date-picker" id="reservation-date" name="reservationDate" required/>
                                    <div class="input-group-append" data-target="#reservation-date-picker" data-toggle="datetimepicker">
                                        <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="return-date">تاريخ العودة</label>
                                <div class="input-group date" id="return-date-picker" data-target-input="nearest">
                                    <input type="text" class="form-control datetimepicker-input" data-target="#return-date-picker" id="return-date" name="returnDate" disabled/>
                                    <div class="input-group-append" data-target="#return-date-picker" data-toggle="datetimepicker">
                                        <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="service-provider">مزود الخدمة <span class="text-danger">*</span></label>
                                <select class="form-control select2" id="service-provider" name="supplierId" style="width: 100%;" required>
                                    <option value="">اختر مزود الخدمة</option>
                                    <option value="1">سابتكو</option>
                                    <option value="2">الخليجية</option>
                                    <option value="3">النقل الجماعي</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- بيانات مالية -->
                <div class="form-section">
                    <h4 class="section-title">البيانات المالية</h4>
                    <div class="row">
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="currency-type">العملة <span class="text-danger">*</span></label>
                                <select class="form-control select2" id="currency-type" name="currency" style="width: 100%;" required>
                                    <option value="SAR" selected>ريال سعودي (SAR)</option>
                                    <option value="USD">دولار أمريكي (USD)</option>
                                    <option value="EUR">يورو (EUR)</option>
                                    <option value="YER">ريال يمني (YER)</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="selling-price">سعر البيع الإجمالي <span class="text-danger">*</span></label>
                                <div class="input-group">
                                    <input type="number" step="0.01" class="form-control" id="selling-price" name="sellPrice" value="120" required>
                                    <div class="input-group-append">
                                        <span class="input-group-text currency-symbol">ر.س</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="cost-price">سعر التكلفة الإجمالي <span class="text-danger">*</span></label>
                                <div class="input-group">
                                    <input type="number" step="0.01" class="form-control" id="cost-price" name="purchasePrice" value="100" required>
                                    <div class="input-group-append">
                                        <span class="input-group-text currency-symbol">ر.س</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3" id="receivedAmountContainer">
                            <div class="form-group">
                                <label for="received-amount">المبلغ الواصل <span class="text-danger">*</span></label>
                                <div class="input-group">
                                    <input type="number" step="0.01" class="form-control" id="received-amount" name="receivedAmount" value="120" required>
                                    <div class="input-group-append">
                                        <span class="input-group-text currency-symbol">ر.س</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="payment-method">طريقة الدفع <span class="text-danger">*</span></label>
                                <select class="form-control select2" id="payment-method" name="paymentType" style="width: 100%;" required>
                                    <option value="">اختر طريقة الدفع</option>
                                    <option value="cash">نقداً</option>
                                    <option value="bank-transfer">تحويل بنكي</option>
                                    <option value="credit">دفع آجل</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="account">الحساب <span class="text-danger">*</span></label>
                                <select class="form-control select2" id="account" name="accountId" style="width: 100%;" required>
                                    <option value="">اختر الحساب</option>
                                    <!-- سيتم تحديث هذه الخيارات ديناميكياً حسب طريقة الدفع -->
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="remaining-amount">المبلغ المتبقي</label>
                                <div class="input-group">
                                    <input type="number" step="0.01" class="form-control" id="remaining-amount" name="remainingAmount" value="0" readonly>
                                    <div class="input-group-append">
                                        <span class="input-group-text currency-symbol">ر.س</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group">
                                <label for="transaction-date">تاريخ ووقت العملية <span class="text-danger">*</span></label>
                                <div class="input-group date" id="transaction-date-picker" data-target-input="nearest">
                                    <input type="text" class="form-control datetimepicker-input" data-target="#transaction-date-picker" id="transaction-date" name="transactionDate" required/>
                                    <div class="input-group-append" data-target="#transaction-date-picker" data-toggle="datetimepicker">
                                        <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group">
                                <label for="statement">البيان</label>
                                <textarea class="form-control" id="statement" name="statement" rows="2"></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save ml-1"></i> حفظ
                    </button>
                    <button type="button" id="cancel-booking" class="btn btn-secondary">
                        <i class="fas fa-times ml-1"></i> إلغاء
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- الإحصائيات المختصرة -->
    <div class="row">
        <div class="col-lg-3 col-6">
            <div class="small-box bg-info">
                <div class="inner">
                    <h3>150</h3>
                    <p>حجوزات هذا الشهر</p>
                </div>
                <div class="icon">
                    <i class="fas fa-bus"></i>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-6">
            <div class="small-box bg-success">
                <div class="inner">
                    <h3>53<sup style="font-size: 20px">%</sup></h3>
                    <p>نسبة الإشغال</p>
                </div>
                <div class="icon">
                    <i class="fas fa-chart-bar"></i>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-6">
            <div class="small-box bg-warning">
                <div class="inner">
                    <h3>15</h3>
                    <p>رحلات اليوم</p>
                </div>
                <div class="icon">
                    <i class="fas fa-calendar-day"></i>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-6">
            <div class="small-box bg-danger">
                <div class="inner">
                    <h3>12,500</h3>
                    <p>إجمالي المبيعات (ر.س)</p>
                </div>
                <div class="icon">
                    <i class="fas fa-money-bill-wave"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- أزرار الإجراءات -->
    <div class="row mb-3">
        <div class="col-md-12">
            <button id="show-booking-form" type="button" class="btn btn-success">
                <i class="fas fa-plus ml-1"></i> حجز جديد
            </button>
            <button type="button" class="btn btn-primary">
                <i class="fas fa-search ml-1"></i> استعلام عن الرحلات
            </button>
            <button type="button" class="btn btn-info">
                <i class="fas fa-print ml-1"></i> طباعة تذكرة
            </button>
            <button type="button" class="btn btn-warning">
                <i class="fas fa-exchange-alt ml-1"></i> تعديل حجز
            </button>
            <button type="button" class="btn btn-danger">
                <i class="fas fa-ban ml-1"></i> إلغاء حجز
            </button>
            <div class="btn-group">
                <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                    <i class="fas fa-filter ml-1"></i> تصفية
                </button>
                <div class="dropdown-menu">
                    <a class="dropdown-item" href="#">جميع الحجوزات</a>
                    <a class="dropdown-item" href="#">حجوزات اليوم</a>
                    <a class="dropdown-item" href="#">الرحلات القادمة</a>
                    <a class="dropdown-item" href="#">الرحلات المنتهية</a>
                    <a class="dropdown-item" href="#">الحجوزات الملغاة</a>
                </div>
            </div>
        </div>
    </div>

    <!-- جدول الحجوزات -->
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">حجوزات تذاكر الباص</h3>
            <div class="card-tools">
                <div class="input-group input-group-sm" style="width: 250px;">
                    <input type="text" name="table_search" class="form-control float-right" placeholder="بحث...">
                    <div class="input-group-append">
                        <button type="submit" class="btn btn-default">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <!-- /.card-header -->
        <div class="card-body table-responsive p-0">
            <table class="table table-hover text-nowrap">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>رقم الحجز</th>
                        <th>اسم المسافر</th>
                        <th>من</th>
                        <th>إلى</th>
                        <th>تاريخ السفر</th>
                        <th>تاريخ الحجز</th>
                        <th>المبلغ</th>
                        <th>الإجراءات</th>
                    </tr>
                </thead>
                <tbody>
                    {% if bookings %}
                        {% for booking in bookings %}
                        <tr>
                            <td>{{ loop.index }}</td>
                            <td>{{ booking.booking_number }}</td>
                            <td>{{ booking.passenger_name }}</td>
                            <td>{{ booking.departure_city }}</td>
                            <td>{{ booking.destination_city }}</td>
                            <td>{{ booking.travel_date.strftime('%Y-%m-%d') if booking.travel_date else 'غير متوفر' }}</td>
                            <td>{{ booking.created_at.strftime('%Y-%m-%d %H:%M') if booking.created_at else 'غير متوفر' }}</td>
                            <td>{{ booking.selling_price }} {{ booking.currency }}</td>
                            <td>
                                <button type="button" class="btn btn-primary btn-xs view-booking" data-id="{{ booking.id }}">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button type="button" class="btn btn-info btn-xs print-booking" data-id="{{ booking.id }}">
                                    <i class="fas fa-print"></i>
                                </button>
                                <button type="button" class="btn btn-warning btn-xs edit-booking" data-id="{{ booking.id }}">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button type="button" class="btn btn-danger btn-xs delete-booking" data-id="{{ booking.id }}">
                                    <i class="fas fa-trash"></i>
                                </button>
                                <button type="button" class="btn btn-success btn-xs view-journals" data-id="{{ booking.id }}" data-booking-number="{{ booking.booking_number }}">
                                    <i class="fas fa-file-invoice-dollar"></i>
                                </button>
                            </td>
                        </tr>
                        {% endfor %}
                    {% else %}
                    <tr>
                        <td colspan="9" class="text-center">لا توجد حجوزات</td>
                    </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
        <!-- /.card-body -->
        <div class="card-footer clearfix">
            <ul class="pagination pagination-sm m-0 float-left">
                <li class="page-item"><a class="page-link" href="#">«</a></li>
                <li class="page-item"><a class="page-link" href="#">1</a></li>
                <li class="page-item"><a class="page-link" href="#">2</a></li>
                <li class="page-item"><a class="page-link" href="#">3</a></li>
                <li class="page-item"><a class="page-link" href="#">»</a></li>
            </ul>
        </div>
    </div>

    <!-- المخططات والإحصائيات -->
    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-chart-line ml-1"></i>
                        إحصائيات الحجوزات
                    </h3>
                    <div class="card-tools">
                        <button type="button" class="btn btn-tool" data-card-widget="collapse">
                            <i class="fas fa-minus"></i>
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="chart" style="position: relative; height:300px;">
                        <canvas id="bookingsChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-bus ml-1"></i>
                        توزيع الحجوزات حسب المسار
                    </h3>
                </div>
                <div class="card-body">
                    <div class="chart" style="position: relative; height:300px;">
                        <canvas id="routesChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
</section>

<!-- Modal - عرض التذكرة -->
<div class="modal fade" id="modal-view-ticket">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary">
                <h4 class="modal-title">تفاصيل الحجز</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="ticket-details">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="info-group">
                                <label>رقم الحجز:</label>
                                <span class="value">BUS-000001</span>
                            </div>
                            <div class="info-group">
                                <label>اسم المسافر:</label>
                                <span class="value">محمد أحمد</span>
                            </div>
                            <div class="info-group">
                                <label>رقم الهوية:</label>
                                <span class="value">1043567890</span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="info-group">
                                <label>تاريخ الحجز:</label>
                                <span class="value">15/06/2023</span>
                            </div>
                            <div class="info-group">
                                <label>حالة الحجز:</label>
                                <span class="value status-confirmed">مؤكد</span>
                            </div>
                            <div class="info-group">
                                <label>طريقة الدفع:</label>
                                <span class="value">نقداً</span>
                            </div>
                        </div>
                    </div>
                    <div class="ticket-price mt-3">
                        <strong>المبلغ المدفوع:</strong> <span>120 ر.س</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-info print-ticket">
                    <i class="fas fa-print ml-1"></i> طباعة التذكرة
                </button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">إغلاق</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal - عرض القيود المحاسبية -->
<div class="modal fade" id="modal-view-journals">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-success">
                <h4 class="modal-title">القيود المحاسبية للحجز</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="journal-details">
                    <h5 class="text-center mb-3">القيود المحاسبية للحجز رقم <span id="journal-booking-number"></span></h5>
                    
                    <!-- القيد الأول: قيد الإيرادات -->
                    <div class="card mb-3">
                        <div class="card-header bg-light">
                            <h6 class="mb-0">قيد الإيرادات <span id="revenue-journal-id"></span></h6>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-bordered mb-0">
                                    <thead>
                                        <tr>
                                            <th>الحساب</th>
                                            <th>البيان</th>
                                            <th>مدين</th>
                                            <th>دائن</th>
                                        </tr>
                                    </thead>
                                    <tbody id="revenue-journal-entries">
                                        <!-- سيتم تعبئة هذا القسم بواسطة JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <!-- القيد الثاني: قيد التكاليف -->
                    <div class="card">
                        <div class="card-header bg-light">
                            <h6 class="mb-0">قيد التكاليف <span id="cost-journal-id"></span></h6>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-bordered mb-0">
                                    <thead>
                                        <tr>
                                            <th>الحساب</th>
                                            <th>البيان</th>
                                            <th>مدين</th>
                                            <th>دائن</th>
                                        </tr>
                                    </thead>
                                    <tbody id="cost-journal-entries">
                                        <!-- سيتم تعبئة هذا القسم بواسطة JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-info" id="print-journals">
                    <i class="fas fa-print ml-1"></i> طباعة القيود
                </button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">إغلاق</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<!-- Moment.js (مطلوب لـ DateTimePicker) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/locale/ar.js"></script>
<!-- tempusdominus DateTimePicker -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.1.2/js/tempusdominus-bootstrap-4.min.js"></script>
<!-- Select2 -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
<!-- SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<!-- Toastr -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>

<script>
// تهيئة المخطط البياني بالإحصائيات
$(document).ready(function() {
    // تهيئة مخطط المبيعات
    if (document.getElementById('bookingsChart')) {
        var ctx = document.getElementById('bookingsChart').getContext('2d');
        var salesChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['يناير', 'فبراير', 'مارس', 'أبريل', 'مايو', 'يونيو', 'يوليو', 'أغسطس', 'سبتمبر', 'أكتوبر', 'نوفمبر', 'ديسمبر'],
                datasets: [{
                    label: 'المبيعات الشهرية (ر.س)',
                    data: [12000, 19000, 15000, 25000, 22000, 30000, 28000, 26000, 29000, 32000, 35000, 40000],
                    backgroundColor: 'rgba(60, 141, 188, 0.2)',
                    borderColor: 'rgba(60, 141, 188, 1)',
                    borderWidth: 2,
                    pointRadius: 4,
                    pointBackgroundColor: '#3c8dbc',
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }
    
    // تهيئة مخطط توزيع المسارات
    if (document.getElementById('routesChart')) {
        var ctx2 = document.getElementById('routesChart').getContext('2d');
        var routesChart = new Chart(ctx2, {
            type: 'doughnut',
            data: {
                labels: ['الرياض - مكة', 'جدة - المدينة', 'الدمام - الرياض', 'أخرى'],
                datasets: [{
                    data: [40, 30, 20, 10],
                    backgroundColor: [
                        'rgba(60, 141, 188, 0.8)',
                        'rgba(0, 192, 239, 0.8)',
                        'rgba(0, 166, 90, 0.8)',
                        'rgba(243, 156, 18, 0.8)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'right',
                        labels: {
                            boxWidth: 15
                        }
                    }
                }
            }
        });
    }
});
</script>

<!-- إضافة ملف JavaScript المخصص لصفحة حجز تذاكر الباص -->
<script src="{{ url_for('static', filename='js/pages/bus-tickets.js') }}"></script>
{% endblock %}