{% extends "layout.html" %}

{% block title %}تأشيرة العمل{% endblock %}

{% block styles %}
<style>
    .form-section {
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        border-radius: 0.5rem;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        background-color: #fff;
        transition: all 0.3s ease;
    }
    
    .form-section:hover {
        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
        transform: translateY(-2px);
    }
    
    .section-title {
        border-bottom: 2px solid #007bff;
        padding-bottom: 0.5rem;
        margin-bottom: 1.5rem;
        color: #495057;
    }
    
    .form-control {
        border-radius: 0.5rem;
    }
    
    .form-control:focus {
        border-color: #80bdff;
        box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
    }
    
    .selected-service {
        background-color: #007bff;
        color: white;
        border-radius: 0.5rem;
        cursor: pointer;
    }
    
    .service-option {
        padding: 15px;
        border-radius: 0.5rem;
        border: 1px solid #dee2e6;
        text-align: center;
        cursor: pointer;
        margin-bottom: 1rem;
        transition: all 0.3s ease;
    }
    
    .service-option:hover {
        border-color: #007bff;
        background-color: #f8f9fa;
    }
    
    .step-navigation {
        display: flex;
        justify-content: space-between;
        margin-top: 2rem;
    }
    
    .visa-progress {
        height: 0.5rem;
        margin-bottom: 2rem;
        border-radius: 0.25rem;
    }
    
    .step-indicator {
        width: 18%;
        text-align: center;
        position: relative;
        margin-bottom: 1rem;
    }
    
    .step-indicator::before {
        content: '';
        height: 30px;
        width: 30px;
        line-height: 30px;
        border: 1px solid #ddd;
        display: block;
        margin: 0 auto 10px auto;
        border-radius: 50%;
        background-color: white;
    }
    
    .step-indicator.active::before {
        background-color: #007bff;
        border-color: #007bff;
        color: white;
    }
    
    .step-text {
        font-size: 0.8rem;
        color: #6c757d;
    }
    
    .steps-container {
        display: flex;
        justify-content: space-between;
    }
    
    .custom-file-label::after {
        content: "استعراض";
    }
</style>
{% endblock %}

{% block content %}
<!-- Content Header (Page header) -->
<div class="content-header">
    <div class="container-fluid">
        <div class="row mb-2">
            <div class="col-sm-6">
                <h1 class="m-0">تأشيرة العمل</h1>
            </div><!-- /.col -->
            <div class="col-sm-6">
                <ol class="breadcrumb float-sm-left">
                    <li class="breadcrumb-item"><a href="{{ url_for('index') }}">الرئيسية</a></li>
                    <li class="breadcrumb-item active">تأشيرة العمل</li>
                </ol>
            </div><!-- /.col -->
        </div><!-- /.row -->
    </div><!-- /.container-fluid -->
</div>
<!-- /.content-header -->

<!-- Main content -->
<section class="content">
    <div class="container-fluid">
        <!-- نظرة عامة -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-briefcase ml-2"></i>إدارة تأشيرات العمل
                        </h3>
                        <div class="card-tools">
                            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modal-add-work-visa">
                                <i class="fas fa-plus"></i> إضافة تأشيرة جديدة
                            </button>
                        </div>
                    </div>
                    <!-- /.card-header -->
                    <div class="card-body table-responsive p-0">
                        <table class="table table-hover text-nowrap datatable">
                            <thead>
                                <tr>
                                    <th>رقم المعاملة</th>
                                    <th>اسم المستفيد</th>
                                    <th>نوع الخدمة</th>
                                    <th>دولة التأشيرة</th>
                                    <th>تاريخ الطلب</th>
                                    <th>حالة التأشيرة</th>
                                    <th>سعر الشراء</th>
                                    <th>سعر البيع</th>
                                    <th>الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>WV-2023001</td>
                                    <td>محمد أحمد</td>
                                    <td>معاملة + تأشيرة</td>
                                    <td>المملكة العربية السعودية</td>
                                    <td>2023-05-10</td>
                                    <td><span class="badge badge-success">تم التسليم</span></td>
                                    <td>800 ريال</td>
                                    <td>1200 ريال</td>
                                    <td>
                                        <button class="btn btn-info btn-sm">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="btn btn-primary btn-sm">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-danger btn-sm">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>WV-2023002</td>
                                    <td>أحمد محمود</td>
                                    <td>معاملة فقط</td>
                                    <td>الإمارات العربية المتحدة</td>
                                    <td>2023-05-15</td>
                                    <td><span class="badge badge-warning">قيد المعالجة</span></td>
                                    <td>500 ريال</td>
                                    <td>850 ريال</td>
                                    <td>
                                        <button class="btn btn-info btn-sm">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="btn btn-primary btn-sm">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-danger btn-sm">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <!-- /.card-body -->
                </div>
                <!-- /.card -->
            </div>
        </div>
        <!-- /.row -->
    </div>
    <!-- /.container-fluid -->
</section>
<!-- /.content -->

<!-- Modal إضافة تأشيرة عمل جديدة -->
<div class="modal fade" id="modal-add-work-visa">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-primary">
                <h4 class="modal-title">إضافة تأشيرة عمل جديدة</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="work-visa-form">
                    <!-- شريط التقدم + المؤشرات -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <div class="progress visa-progress">
                                <div class="progress-bar bg-primary" role="progressbar" style="width: 20%;" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                            
                            <div class="steps-container">
                                <div class="step-indicator active" data-step="1">
                                    <div class="step-text">نوع الخدمة</div>
                                </div>
                                <div class="step-indicator" data-step="2">
                                    <div class="step-text">بيانات المستفيد</div>
                                </div>
                                <div class="step-indicator" data-step="3">
                                    <div class="step-text">بيانات التأشيرة</div>
                                </div>
                                <div class="step-indicator" data-step="4">
                                    <div class="step-text">الوثائق</div>
                                </div>
                                <div class="step-indicator" data-step="5">
                                    <div class="step-text">التكلفة والدفع</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- القسم 1: اختيار نوع الخدمة -->
                    <div class="section active" id="section-service">
                        <div class="form-section">
                            <h4 class="section-title">
                                <i class="fas fa-cogs ml-2"></i>اختر نوع الخدمة
                            </h4>
                            
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="service-option" data-service="transaction-only">
                                        <i class="fas fa-file-alt fa-3x mb-3"></i>
                                        <h5>معاملة فقط</h5>
                                        <p class="text-muted">إجراء معاملة التأشيرة دون إصدار التأشيرة</p>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="service-option" data-service="visa-only">
                                        <i class="fas fa-passport fa-3x mb-3"></i>
                                        <h5>تأشيرة فقط</h5>
                                        <p class="text-muted">إصدار التأشيرة دون إجراء المعاملة</p>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="service-option selected-service" data-service="both">
                                        <i class="fas fa-clipboard-check fa-3x mb-3"></i>
                                        <h5>معاملة + تأشيرة</h5>
                                        <p class="text-muted">إجراء معاملة التأشيرة مع إصدار التأشيرة</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="step-navigation">
                            <button type="button" class="btn btn-default">إلغاء</button>
                            <button type="button" class="btn btn-primary next-step" data-next="section-beneficiary">التالي <i class="fas fa-arrow-left"></i></button>
                        </div>
                    </div>
                    
                    <!-- القسم 2: بيانات المستفيد -->
                    <div class="section" id="section-beneficiary" style="display: none;">
                        <div class="form-section">
                            <h4 class="section-title">
                                <i class="fas fa-user ml-2"></i>بيانات المستفيد
                            </h4>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="beneficiary_name">اسم المستفيد الكامل <span class="text-danger">*</span></label>
                                        <input type="text" class="form-control" id="beneficiary_name" placeholder="ادخل الاسم الكامل" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="id_type">نوع الهوية <span class="text-danger">*</span></label>
                                        <select class="form-control" id="id_type" required>
                                            <option value="">اختر نوع الهوية</option>
                                            <option value="national-id">هوية وطنية</option>
                                            <option value="iqama">إقامة</option>
                                            <option value="passport">جواز سفر</option>
                                            <option value="other">أخرى</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label for="id_number">رقم الهوية <span class="text-danger">*</span></label>
                                        <input type="text" class="form-control" id="id_number" placeholder="ادخل رقم الهوية" required>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="phone">رقم الجوال <span class="text-danger">*</span></label>
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text"><i class="fas fa-phone"></i></span>
                                            </div>
                                            <input type="text" class="form-control" id="phone" placeholder="أدخل رقم الجوال" required>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="email">البريد الإلكتروني</label>
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text"><i class="fas fa-envelope"></i></span>
                                            </div>
                                            <input type="email" class="form-control" id="email" placeholder="أدخل البريد الإلكتروني">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="step-navigation">
                            <button type="button" class="btn btn-default prev-step" data-prev="section-service"><i class="fas fa-arrow-right"></i> السابق</button>
                            <button type="button" class="btn btn-primary next-step" data-next="section-visa-details">التالي <i class="fas fa-arrow-left"></i></button>
                        </div>
                    </div>
                    
                    <!-- القسم 3: بيانات التأشيرة -->
                    <div class="section" id="section-visa-details" style="display: none;">
                        <div class="form-section">
                            <h4 class="section-title">
                                <i class="fas fa-passport ml-2"></i>بيانات التأشيرة
                            </h4>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="visa_country">دولة التأشيرة <span class="text-danger">*</span></label>
                                        <select class="form-control" id="visa_country" required>
                                            <option value="">اختر الدولة</option>
                                            <option value="saudi-arabia">المملكة العربية السعودية</option>
                                            <option value="uae">الإمارات العربية المتحدة</option>
                                            <option value="kuwait">الكويت</option>
                                            <option value="bahrain">البحرين</option>
                                            <option value="qatar">قطر</option>
                                            <option value="oman">عمان</option>
                                            <option value="other">أخرى</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="visa_type">نوع التأشيرة <span class="text-danger">*</span></label>
                                        <select class="form-control" id="visa_type" required>
                                            <option value="">اختر نوع التأشيرة</option>
                                            <option value="work">عمل</option>
                                            <option value="visit">زيارة</option>
                                            <option value="residence">إقامة</option>
                                            <option value="business">رجال أعمال</option>
                                            <option value="other">أخرى</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="request_date">تاريخ تقديم الطلب <span class="text-danger">*</span></label>
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text"><i class="fas fa-calendar"></i></span>
                                            </div>
                                            <input type="date" class="form-control" id="request_date" required>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="expected_completion">تاريخ الإنجاز المتوقع</label>
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text"><i class="fas fa-calendar-check"></i></span>
                                            </div>
                                            <input type="date" class="form-control" id="expected_completion">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="visa_duration">مدة التأشيرة (بالأشهر)</label>
                                        <input type="number" class="form-control" id="visa_duration" placeholder="أدخل مدة التأشيرة بالأشهر">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="visa_status">حالة التأشيرة <span class="text-danger">*</span></label>
                                        <select class="form-control" id="visa_status" required>
                                            <option value="">اختر حالة التأشيرة</option>
                                            <option value="new" selected>جديدة</option>
                                            <option value="under-processing">قيد المعالجة</option>
                                            <option value="pending">معلقة</option>
                                            <option value="approved">تمت الموافقة</option>
                                            <option value="rejected">مرفوضة</option>
                                            <option value="delivered">تم التسليم</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label for="visa_notes">ملاحظات</label>
                                        <textarea class="form-control" id="visa_notes" rows="3" placeholder="أدخل أية ملاحظات إضافية عن التأشيرة"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="step-navigation">
                            <button type="button" class="btn btn-default prev-step" data-prev="section-beneficiary"><i class="fas fa-arrow-right"></i> السابق</button>
                            <button type="button" class="btn btn-primary next-step" data-next="section-documents">التالي <i class="fas fa-arrow-left"></i></button>
                        </div>
                    </div>
                    
                    <!-- القسم 4: الوثائق -->
                    <div class="section" id="section-documents" style="display: none;">
                        <div class="form-section">
                            <h4 class="section-title">
                                <i class="fas fa-file-upload ml-2"></i>الوثائق المطلوبة
                            </h4>
                            
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle ml-2"></i>
                                يرجى تحميل نسخ واضحة من المستندات المطلوبة. الصيغ المقبولة: JPG، PDF، PNG
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="id_copy">صورة الهوية <span class="text-danger">*</span></label>
                                        <div class="custom-file">
                                            <input type="file" class="custom-file-input" id="id_copy" required>
                                            <label class="custom-file-label" for="id_copy">اختر الملف</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="photo">الصورة الشخصية <span class="text-danger">*</span></label>
                                        <div class="custom-file">
                                            <input type="file" class="custom-file-input" id="photo" required>
                                            <label class="custom-file-label" for="photo">اختر الملف</label>
                                        </div>
                                        <small class="form-text text-muted">صورة شخصية بخلفية بيضاء، مقاس 4×6 سم</small>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="passport_copy">صورة جواز السفر <span class="text-danger">*</span></label>
                                        <div class="custom-file">
                                            <input type="file" class="custom-file-input" id="passport_copy" required>
                                            <label class="custom-file-label" for="passport_copy">اختر الملف</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="other_documents">مستندات أخرى</label>
                                        <div class="custom-file">
                                            <input type="file" class="custom-file-input" id="other_documents" multiple>
                                            <label class="custom-file-label" for="other_documents">اختر الملفات</label>
                                        </div>
                                        <small class="form-text text-muted">يمكنك تحميل عدة ملفات في وقت واحد</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="step-navigation">
                            <button type="button" class="btn btn-default prev-step" data-prev="section-visa-details"><i class="fas fa-arrow-right"></i> السابق</button>
                            <button type="button" class="btn btn-primary next-step" data-next="section-payment">التالي <i class="fas fa-arrow-left"></i></button>
                        </div>
                    </div>
                    
                    <!-- القسم 5: التكلفة والدفع -->
                    <div class="section" id="section-payment" style="display: none;">
                        <div class="form-section">
                            <h4 class="section-title">
                                <i class="fas fa-money-bill-wave ml-2"></i>التكلفة والدفع
                            </h4>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="purchase_price">سعر الشراء <span class="text-danger">*</span></label>
                                        <div class="input-group">
                                            <input type="number" min="0" step="0.01" class="form-control" id="purchase_price" placeholder="أدخل سعر الشراء" required>
                                            <div class="input-group-append">
                                                <span class="input-group-text">ر.س</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="selling_price">سعر البيع <span class="text-danger">*</span></label>
                                        <div class="input-group">
                                            <input type="number" min="0" step="0.01" class="form-control" id="selling_price" placeholder="أدخل سعر البيع" required>
                                            <div class="input-group-append">
                                                <span class="input-group-text">ر.س</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="payment_method">طريقة الدفع <span class="text-danger">*</span></label>
                                        <select class="form-control" id="payment_method" required>
                                            <option value="">اختر طريقة الدفع</option>
                                            <option value="cash">نقدًا</option>
                                            <option value="bank-transfer">تحويل بنكي</option>
                                            <option value="credit-card">بطاقة ائتمان</option>
                                            <option value="customer-account">حساب العميل</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6 payment-details-cash" style="display: none;">
                                    <div class="form-group">
                                        <label for="cashbox">الصندوق <span class="text-danger">*</span></label>
                                        <select class="form-control" id="cashbox">
                                            <option value="">اختر الصندوق</option>
                                            <option value="main-cashbox">الصندوق الرئيسي</option>
                                            <option value="branch-cashbox">صندوق الفرع</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6 payment-details-bank" style="display: none;">
                                    <div class="form-group">
                                        <label for="bank_account">الحساب البنكي <span class="text-danger">*</span></label>
                                        <select class="form-control" id="bank_account">
                                            <option value="">اختر الحساب البنكي</option>
                                            <option value="alrajhi">بنك الراجحي</option>
                                            <option value="riyadh">بنك الرياض</option>
                                            <option value="ahli">البنك الأهلي</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6 payment-details-credit" style="display: none;">
                                    <div class="form-group">
                                        <label for="customer_account">حساب العميل <span class="text-danger">*</span></label>
                                        <select class="form-control" id="customer_account">
                                            <option value="">اختر حساب العميل</option>
                                            <option value="account1">حساب محمد أحمد</option>
                                            <option value="account2">حساب خالد محمد</option>
                                            <option value="account3">حساب أحمد علي</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="down_payment">الدفعة المقدمة</label>
                                        <div class="input-group">
                                            <input type="number" min="0" step="0.01" class="form-control" id="down_payment" placeholder="أدخل مبلغ الدفعة المقدمة">
                                            <div class="input-group-append">
                                                <span class="input-group-text">ر.س</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="remaining_amount">المبلغ المتبقي</label>
                                        <div class="input-group">
                                            <input type="number" min="0" step="0.01" class="form-control" id="remaining_amount" readonly>
                                            <div class="input-group-append">
                                                <span class="input-group-text">ر.س</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label for="payment_notes">ملاحظات الدفع</label>
                                        <textarea class="form-control" id="payment_notes" rows="2" placeholder="أدخل أية ملاحظات متعلقة بالدفع"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="step-navigation">
                            <button type="button" class="btn btn-default prev-step" data-prev="section-documents"><i class="fas fa-arrow-right"></i> السابق</button>
                            <button type="submit" class="btn btn-success">حفظ التأشيرة</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
<!-- /.modal -->
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // تهيئة النموذج متعدد الخطوات
        initializeWorkVisaForm();
        
        // تحديث المبلغ المتبقي عند تغيير سعر البيع أو الدفعة المقدمة
        document.getElementById('selling_price').addEventListener('input', updateRemainingAmount);
        document.getElementById('down_payment').addEventListener('input', updateRemainingAmount);
        
        // معالجة طريقة الدفع
        document.getElementById('payment_method').addEventListener('change', handlePaymentMethod);
        
        // معالجة اختيار نوع الخدمة
        const serviceOptions = document.querySelectorAll('.service-option');
        serviceOptions.forEach(option => {
            option.addEventListener('click', function() {
                // إزالة التحديد من جميع الخيارات
                serviceOptions.forEach(opt => opt.classList.remove('selected-service'));
                // إضافة التحديد للخيار المحدد
                this.classList.add('selected-service');
            });
        });
        
        // معالجة تقديم النموذج
        document.getElementById('work-visa-form').addEventListener('submit', function(e) {
            e.preventDefault();
            // هنا يمكنك إضافة التحقق من صحة البيانات وإرسالها للخادم
            alert('تم حفظ تأشيرة العمل بنجاح!');
            $('#modal-add-work-visa').modal('hide');
        });
        
        // معالجة تحميل الملفات لإظهار اسم الملف
        const fileInputs = document.querySelectorAll('.custom-file-input');
        fileInputs.forEach(input => {
            input.addEventListener('change', function() {
                const fileName = this.value.split('\\').pop();
                this.nextElementSibling.textContent = fileName || 'اختر الملف';
            });
        });
    });
    
    // تهيئة النموذج متعدد الخطوات
    function initializeWorkVisaForm() {
        // الأزرار للانتقال بين الخطوات
        const nextButtons = document.querySelectorAll('.next-step');
        const prevButtons = document.querySelectorAll('.prev-step');
        
        // معالجة أزرار "التالي"
        nextButtons.forEach(button => {
            button.addEventListener('click', function() {
                const currentSection = this.closest('.section');
                const nextSectionId = this.getAttribute('data-next');
                const nextSection = document.getElementById(nextSectionId);
                
                if (validateSection(currentSection)) {
                    // إخفاء القسم الحالي وإظهار القسم التالي
                    currentSection.style.display = 'none';
                    nextSection.style.display = 'block';
                    
                    // تحديث شريط التقدم ومؤشرات الخطوات
                    updateProgress(nextSectionId);
                }
            });
        });
        
        // معالجة أزرار "السابق"
        prevButtons.forEach(button => {
            button.addEventListener('click', function() {
                const currentSection = this.closest('.section');
                const prevSectionId = this.getAttribute('data-prev');
                const prevSection = document.getElementById(prevSectionId);
                
                // إخفاء القسم الحالي وإظهار القسم السابق
                currentSection.style.display = 'none';
                prevSection.style.display = 'block';
                
                // تحديث شريط التقدم ومؤشرات الخطوات
                updateProgress(prevSectionId);
            });
        });
    }
    
    // التحقق من صحة بيانات القسم
    function validateSection(section) {
        const requiredFields = section.querySelectorAll('[required]');
        let isValid = true;
        
        requiredFields.forEach(field => {
            if (!field.value) {
                field.classList.add('is-invalid');
                isValid = false;
            } else {
                field.classList.remove('is-invalid');
            }
        });
        
        if (!isValid) {
            alert('يرجى إكمال جميع الحقول المطلوبة');
        }
        
        return isValid;
    }
    
    // تحديث شريط التقدم ومؤشرات الخطوات
    function updateProgress(sectionId) {
        const stepMatch = sectionId.match(/section-(\w+)/);
        if (!stepMatch) return;
        
        let step = 1;
        switch (stepMatch[1]) {
            case 'service': step = 1; break;
            case 'beneficiary': step = 2; break;
            case 'visa-details': step = 3; break;
            case 'documents': step = 4; break;
            case 'payment': step = 5; break;
        }
        
        // تحديث شريط التقدم
        const progressBar = document.querySelector('.progress-bar');
        const progressPercentage = (step / 5) * 100;
        progressBar.style.width = progressPercentage + '%';
        progressBar.setAttribute('aria-valuenow', progressPercentage);
        
        // تحديث مؤشرات الخطوات
        const stepIndicators = document.querySelectorAll('.step-indicator');
        stepIndicators.forEach((indicator, index) => {
            if (index < step) {
                indicator.classList.add('active');
            } else {
                indicator.classList.remove('active');
            }
        });
    }
    
    // تحديث المبلغ المتبقي
    function updateRemainingAmount() {
        const sellingPrice = parseFloat(document.getElementById('selling_price').value) || 0;
        const downPayment = parseFloat(document.getElementById('down_payment').value) || 0;
        const remainingAmount = sellingPrice - downPayment;
        
        document.getElementById('remaining_amount').value = remainingAmount.toFixed(2);
    }
    
    // معالجة طريقة الدفع
    function handlePaymentMethod() {
        const paymentMethod = document.getElementById('payment_method').value;
        
        // إخفاء جميع تفاصيل الدفع
        document.querySelector('.payment-details-cash').style.display = 'none';
        document.querySelector('.payment-details-bank').style.display = 'none';
        document.querySelector('.payment-details-credit').style.display = 'none';
        
        // إظهار التفاصيل المناسبة حسب طريقة الدفع المختارة
        if (paymentMethod === 'cash') {
            document.querySelector('.payment-details-cash').style.display = 'block';
        } else if (paymentMethod === 'bank-transfer') {
            document.querySelector('.payment-details-bank').style.display = 'block';
        } else if (paymentMethod === 'customer-account') {
            document.querySelector('.payment-details-credit').style.display = 'block';
        }
    }
</script>
{% endblock %}